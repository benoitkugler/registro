import{co as R,aF as se,aH as oe,d as I,k as g,z as w,o as y,v as ee,w as t,b as e,m as P,j as T,n as O,p as re,q as ue,s as L,u as j,e as p,l as S,L as ie,g as U,h as m,N as de,c as E,_ as ce,$ as F,X as me,A as B,a as pe,B as fe,E as Y,t as h,C as x,H as ve,D as Q,F as ge,az as Ve,V as De,av as he,f as ye,i as we,aA as W,aB as _e,aC as be,aD as ke}from"./VSnackbar-lB5Kt1MJ.js";import{b as K,c as Ce,V as z,i as Re,j as Ue,e as H,g as xe,d as Le,f as Me}from"./VSelect-Cq60DlPv.js";import{a as $e,_ as Ee,V as Ae}from"./ModePaiementField.vue_vue_type_script_setup_true_lang-cXOPhjRU.js";import{_ as Te}from"./MontantField.vue_vue_type_script_setup_true_lang-BxEmZgXz.js";import{V as He}from"./VCombobox-DHI4wgy1.js";import{V as Pe}from"./VTooltip-CatPFXah.js";import{V as Z}from"./VDialog-DNm6CVPi.js";import"./VPicker-BNvQ31aE.js";import"./VSheet-B0H-_6Rs.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./filter-DN9khlHE.js";const A={Cheque:0,EnLigne:1,Virement:2,Especes:3,Ancv:4,Helloasso:5},Se={[A.Cheque]:"Chèque",[A.EnLigne]:"Carte bancaire (en ligne)",[A.Virement]:"Virement",[A.Especes]:"Espèces",[A.Ancv]:"ANCV",[A.Helloasso]:"Helloasso"};class Ie{constructor(l,n){this.baseURL=l,this.authToken=n}getHeaders(){return{Authorization:"Bearer "+this.authToken}}async Loggin(l){const n=this.baseURL+"/api/v1/loggin";this.startRequest();try{return(await R.get(n,{headers:this.getHeaders(),params:{password:l.password}})).data}catch(a){this.handleError(a)}}async LoadDons(){const l=this.baseURL+"/api/v1/dons";this.startRequest();try{return(await R.get(l,{headers:this.getHeaders()})).data}catch(n){this.handleError(n)}}async UpdateDon(l){const n=this.baseURL+"/api/v1/dons";this.startRequest();try{return await R.post(n,l,{headers:this.getHeaders()}),!0}catch(a){this.handleError(a)}}async CreateDon(l){const n=this.baseURL+"/api/v1/dons";this.startRequest();try{return(await R.put(n,l,{headers:this.getHeaders()})).data}catch(a){this.handleError(a)}}async DeleteDon(l){const n=this.baseURL+"/api/v1/dons";this.startRequest();try{return await R.delete(n,{headers:this.getHeaders(),params:{id:String(l.id)}}),!0}catch(a){this.handleError(a)}}async SearchPersonnes(l){const n=this.baseURL+"/api/v1/dons/search-personnes";this.startRequest();try{return(await R.get(n,{headers:this.getHeaders(),params:{search:l.search}})).data}catch(a){this.handleError(a)}}async SearchOrganismes(l){const n=this.baseURL+"/api/v1/dons/search-organismes";this.startRequest();try{return(await R.get(n,{headers:this.getHeaders(),params:{search:l.search}})).data}catch(a){this.handleError(a)}}DownloadRecusFiscaux(l,n){return this.baseURL+`/api/v1/dons/download-recus-fiscaux?year=${l}&token=${n}`}DownloadDonsExcel(l,n){return this.baseURL+`/api/v1/dons/download-dons?year=${l}&token=${n}`}}class qe extends Ie{constructor(l,n,a){super(a,""),this.onError=l,this.showMessage=n}handleError(l){const{kind:n,messageHtml:a}=oe(l);this.onError(n,a)}startRequest(){}setToken(l){this.authToken=l}}const v=new qe((C,l)=>{},(C,l)=>{},se()),Fe=I({__name:"LogginPage",emits:["enter"],setup(C,{emit:l}){const n=l,a=g(!1),u=g(""),V=g([]);async function r(){const D=await v.Loggin({password:u.value});D!==void 0&&(D.IsValid?(v.setToken(D.Token),v.showMessage("Bienvenue !"),n("enter")):V.value=["Clé de connection incorrecte."])}return(D,f)=>(y(),w(ee,{class:"fill-height"},{default:t(()=>[e(S,{class:"mx-auto",width:"400px"},{default:t(()=>[e(P,null,{default:t(()=>[T("form",null,[e(O,{label:"Clé de connection",modelValue:u.value,"onUpdate:modelValue":f[1]||(f[1]=_=>u.value=_),"error-messages":V.value,type:a.value?void 0:"password",name:"password",onKeydown:f[2]||(f[2]=re(ue(()=>u.value.length==0?null:r(),["prevent"]),["enter"])),autocomplete:"current-password"},{"append-inner":t(()=>[e(L,{class:"ml-2",size:"small",icon:a.value?"mdi-eye":"mdi-eye-off",flat:"",onClick:f[0]||(f[0]=_=>a.value=!a.value)},null,8,["icon"])]),_:1},8,["modelValue","error-messages","type"])])]),_:1}),e(j,null,{default:t(()=>[e(K),e(L,{disabled:!u.value.length,onClick:r},{default:t(()=>[...f[3]||(f[3]=[p("Se connecter",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}))}}),Be=I({__name:"DonPannel",props:{don:{},affectationHints:{}},emits:["save"],setup(C,{emit:l}){const n=C,a=l,u=g(ie(n.don));return(V,r)=>{const D=Te,f=$e,_=Ee;return y(),w(S,{title:"Modifier le don"},{append:t(()=>[...r[7]||(r[7]=[])]),default:t(()=>[e(P,null,{default:t(()=>[e(U,null,{default:t(()=>[e(m)]),_:1}),e(U,null,{default:t(()=>[e(m,null,{default:t(()=>[e(D,{modelValue:u.value.Montant,"onUpdate:modelValue":r[0]||(r[0]=i=>u.value.Montant=i),label:"Montant"},null,8,["modelValue"])]),_:1}),e(m,null,{default:t(()=>[e(f,{modelValue:u.value.ModePaiement,"onUpdate:modelValue":r[1]||(r[1]=i=>u.value.ModePaiement=i)},null,8,["modelValue"])]),_:1})]),_:1}),e(U,null,{default:t(()=>[e(m,null,{default:t(()=>[e(O,{modelValue:u.value.Details,"onUpdate:modelValue":r[2]||(r[2]=i=>u.value.Details=i),label:"Détails",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(m,null,{default:t(()=>[e(He,{label:"Affectation",items:n.affectationHints,modelValue:u.value.Affectation,"onUpdate:modelValue":r[3]||(r[3]=i=>u.value.Affectation=i),density:"compact",variant:"outlined"},null,8,["items","modelValue"])]),_:1})]),_:1}),e(U,null,{default:t(()=>[e(m,null,{default:t(()=>[e(_,{modelValue:u.value.Date,"onUpdate:modelValue":r[4]||(r[4]=i=>u.value.Date=i),label:"Date"},null,8,["modelValue"])]),_:1}),e(m,null,{default:t(()=>[e(Ce,{density:"compact",modelValue:u.value.Remercie,"onUpdate:modelValue":r[5]||(r[5]=i=>u.value.Remercie=i),label:"Remercié ?","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(j,null,{default:t(()=>[e(K),e(L,{onClick:r[6]||(r[6]=i=>a("save",u.value))},{default:t(()=>[...r[8]||(r[8]=[p("Enregistrer",-1)])]),_:1})]),_:1})]),_:1})}}}),N=16,Ye=I({__name:"DonsV",emits:["update:selectedYear"],setup(C,{emit:l}){const n=l;de(()=>{q(),n("update:selectedYear",d())});const a=g(null),u=E(()=>Array.from(new Set(a.value?.Dons?.map(c=>c.Don.Affectation)).keys()).filter(c=>c!="").sort()),V=ce({pattern:"",year:d()}),r=E(()=>{const c=F(V.pattern),s=(a.value?.Dons||[]).filter(o=>new Date(o.Don.Date).getFullYear()==V.year&&(c==""||F(o.Donateur).includes(c)||F(o.Don.Details).includes(c)));return s.sort((o,k)=>{const X=new Date(k.Don.Date).valueOf(),J=new Date(o.Don.Date).valueOf();return X==J?o.Don.Id-k.Don.Id:X-J}),s}),D=E(()=>r.value.slice((i.value-1)*N,i.value*N));function f(){i.value>_.value&&(i.value=_.value)}const _=E(()=>Math.max(Math.ceil(r.value.length/N),1)),i=g(1);function d(){return new Date(Date.now()).getFullYear()}const M=E(()=>{const c=new Set(Object.keys(a.value?.YearTotals||{}).map(Number));return c.add(d()),Array.from(c.keys()).sort()}),G=E(()=>(a.value?.YearTotals||{})[V.year]||{Particuliers:"",Organismes:""});async function q(){const c=await v.LoadDons();c!==void 0&&(a.value=c||[],f())}const $=g(null);async function ae(c){$.value=null,await v.UpdateDon(c)!==void 0&&(v.showMessage("Don modifié avec succès."),q())}const b=g(null);async function le(){if(!b.value)return;const c=b.value;b.value=null,await v.DeleteDon({id:c.Don.Id})!==void 0&&(v.showMessage("Don supprimé avec succès."),q())}async function ne(c){c.Remercie=!c.Remercie,await v.UpdateDon(c)!==void 0&&(v.showMessage("Don modifié avec succès."),f())}return(c,s)=>a.value==null?(y(),w(me,{key:0,type:"table"})):(y(),w(S,{key:1,title:"Dons",subtitle:r.value.length==a.value.Dons?.length?`${a.value.Dons.length}`:`${r.value.length} visibles sur ${a.value.Dons?.length}`,width:"100%"},{append:t(()=>[e(U,null,{default:t(()=>[e(m,{"align-self":"center"},{default:t(()=>[e(H,null,{default:t(()=>[p("Total annuel particuliers "+h(G.value.Particuliers),1)]),_:1})]),_:1}),e(m,{"align-self":"center"},{default:t(()=>[e(H,null,{default:t(()=>[p("Total annuel organismes "+h(G.value.Organismes),1)]),_:1})]),_:1}),e(m,null,{default:t(()=>[e(O,{width:"200px",label:"Recherche",variant:"outlined",density:"compact","hide-details":"",placeholder:"Rechercher...",clearable:"","onClick:clear":s[0]||(s[0]=o=>V.pattern=""),modelValue:V.pattern,"onUpdate:modelValue":s[1]||(s[1]=o=>V.pattern=o)},null,8,["modelValue"])]),_:1}),e(m,null,{default:t(()=>[e(Me,{label:"Année",modelValue:V.year,"onUpdate:modelValue":[s[2]||(s[2]=o=>V.year=o),s[3]||(s[3]=o=>n("update:selectedYear",o))],variant:"outlined",density:"compact",items:M.value,"hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),default:t(()=>[e(P,{class:"mt-2"},{default:t(()=>[D.value.length?B("",!0):(y(),w(z,{key:0},{default:t(()=>[...s[7]||(s[7]=[T("i",null,"Aucun don.",-1)])]),_:1})),(y(!0),pe(ge,null,fe(D.value,o=>(y(),w(U,null,{default:t(()=>[e(m,{cols:"auto","align-self":"center"},{default:t(()=>[e(Y,{icon:o.Don.IdPersonne.Valid?"":"mdi-account-group"},null,8,["icon"])]),_:2},1024),e(m,{cols:"5","align-self":"center"},{default:t(()=>[e(Re,null,{default:t(()=>[p(h(o.Donateur),1)]),_:2},1024),e(Ue,null,{default:t(()=>[p(h([o.Don.Affectation,o.Don.Details].filter(k=>k).join(" ; ")),1)]),_:2},1024)]),_:2},1024),e(m,{"align-self":"center",class:"text-center"},{default:t(()=>[e(H,{variant:"outlined"},{default:t(()=>[p(h(o.Montant),1)]),_:2},1024)]),_:2},1024),e(m,{"align-self":"center",cols:"1",class:"text-center"},{default:t(()=>[e(Pe,null,{activator:t(({props:k})=>[e(Y,ve({ref_for:!0},k,{icon:x(Q).paiementIcon(o.Don.ModePaiement)}),null,16,["icon"])]),default:t(()=>[p(" "+h(x(Se)[o.Don.ModePaiement]),1)]),_:2},1024)]),_:2},1024),e(m,{"align-self":"center",class:"text-center"},{default:t(()=>[p(h(x(Q).date(o.Don.Date,!0,!1)),1)]),_:2},1024),e(m,{"align-self":"center",class:"text-center",cols:"auto"},{default:t(()=>[e(H,{color:o.Don.Remercie?"green":"orange","prepend-icon":o.Don.Remercie?"mdi-check":"",elevation:"1",onClick:k=>ne(o.Don)},{default:t(()=>[p(h(o.Don.Remercie?"Remercié":"À remercier"),1)]),_:2},1032,["color","prepend-icon","onClick"])]),_:2},1024),e(m,{cols:"auto"},{default:t(()=>[e(L,{icon:"",size:"small",flat:""},{default:t(()=>[e(Y,null,{default:t(()=>[...s[8]||(s[8]=[p("mdi-dots-vertical",-1)])]),_:1}),e(xe,{activator:"parent"},{default:t(()=>[e(Le,{density:"compact"},{default:t(()=>[e(z,{title:"Modifier","prepend-icon":"mdi-pencil",onClick:k=>$.value=o.Don},null,8,["onClick"]),e(z,{title:"Supprimer","prepend-icon":"mdi-delete",onClick:k=>b.value=o},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),256)),e(Ae,{length:_.value,modelValue:i.value,"onUpdate:modelValue":s[4]||(s[4]=o=>i.value=o)},null,8,["length","modelValue"])]),_:1}),e(Z,{"model-value":$.value!=null,"onUpdate:modelValue":s[5]||(s[5]=o=>$.value=null),"max-width":"600px"},{default:t(()=>[$.value?(y(),w(Be,{key:0,don:$.value,"affectation-hints":u.value,onSave:ae},null,8,["don","affectation-hints"])):B("",!0)]),_:1},8,["model-value"]),e(Z,{"model-value":b.value!=null,"onUpdate:modelValue":s[6]||(s[6]=o=>b.value=null),"max-width":"600px"},{default:t(()=>[b.value?(y(),w(S,{key:0,title:"Confirmation"},{default:t(()=>[e(P,null,{default:t(()=>[p("Confirmez-vous la suppression du don de "+h(b.value.Donateur)+" d'un montant de "+h(b.value.Montant)+" ? ",1),s[9]||(s[9]=T("br",null,null,-1)),s[10]||(s[10]=T("br",null,null,-1)),s[11]||(s[11]=p(" Attention, cette opération est irréversible.",-1))]),_:1}),e(j,null,{default:t(()=>[e(K),e(L,{color:"red",onClick:le},{default:t(()=>[...s[12]||(s[12]=[p("Supprimer",-1)])]),_:1})]),_:1})]),_:1})):B("",!0)]),_:1},8,["model-value"])]),_:1},8,["subtitle"]))}}),ze=["innerHTML"],Ne=I({__name:"App",setup(C){const l=g(""),n=g("secondary"),a=g(""),u=g("");v.onError=(i,d)=>{a.value=i,u.value=d},v.showMessage=(i,d)=>{l.value=i,n.value=d||"success"};const V="/static/acve/logo.png",r=g(!1),D=g(0),f=g(!1);function _(){f.value=!0,setTimeout(()=>f.value=!1,3e3)}return(i,d)=>(y(),w(_e,null,{default:t(()=>[e(Ve,null,{default:t(()=>[e(De,{rounded:"",elevation:"4",color:"primary"},he({default:t(()=>[e(ye,null,{default:t(()=>[e(U,null,{default:t(()=>[e(m,{"align-self":"center",cols:"auto"},{default:t(()=>[e(we,{width:"60",src:V})]),_:1}),e(m,{"align-self":"center"},{default:t(()=>[...d[4]||(d[4]=[p(" Gestion des dons ",-1)])]),_:1})]),_:1})]),_:1})]),_:2},[r.value?{name:"append",fn:t(()=>[e(L,{"prepend-icon":"mdi-download",href:x(v).DownloadDonsExcel(D.value,x(v).authToken)},{default:t(()=>[...d[5]||(d[5]=[p("Exporter",-1)])]),_:1},8,["href"]),e(L,{"prepend-icon":"mdi-receipt-text",href:x(v).DownloadRecusFiscaux(D.value,x(v).authToken),disabled:f.value,onClick:_},{default:t(()=>[...d[6]||(d[6]=[p("Télécharger les reçus fiscaux",-1)])]),_:1},8,["href","disabled"])]),key:"0"}:void 0]),1024),e(ee,{class:"fill-height"},{default:t(()=>[r.value?(y(),w(Ye,{key:1,"onUpdate:selectedYear":d[1]||(d[1]=M=>D.value=M)})):(y(),w(Fe,{key:0,onEnter:d[0]||(d[0]=M=>r.value=!0)}))]),_:1}),e(W,{style:{"z-index":"10000"},app:"","model-value":l.value!="","onUpdate:modelValue":d[2]||(d[2]=M=>l.value=""),timeout:4e3,color:n.value,location:"bottom left","close-on-content-click":""},{default:t(()=>[p(h(l.value),1)]),_:1},8,["model-value","color"]),e(W,{app:"","model-value":a.value!="","onUpdate:modelValue":d[3]||(d[3]=M=>a.value=""),timeout:4e3,color:"red"},{default:t(()=>[T("b",null,h(a.value),1),T("div",{innerHTML:u.value},null,8,ze)]),_:1},8,["model-value"])]),_:1})]),_:1}))}}),te=be(Ne);te.use(ke);te.mount("#app");
