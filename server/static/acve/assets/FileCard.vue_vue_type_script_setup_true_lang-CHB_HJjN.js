import{a8 as q,c as h,a7 as Be,ae as Te,af as xe,cb as Z,bo as ze,cV as G,k as D,bX as Ae,aY as Pe,G as Re,ac as $e,c8 as _e,bp as U,cW as K,b as c,H as I,bq as je,cX as Me,br as Ne,j as p,F as P,cY as Ee,ad as Le,bE as J,cZ as Oe,d as Q,ax as Ge,z as ee,o as te,w as f,l as W,m as Ue,C as V,D as H,e as w,t as Ke,u as We,s as X,bH as Y,i as He}from"./VSnackbar-lB5Kt1MJ.js";import{e as Xe,g as Ye,V as qe,b as Ze}from"./VSelect-Cq60DlPv.js";function Je(){function e(l){return[...l.dataTransfer?.items??[]].filter(a=>a.kind==="file").map(a=>a.webkitGetAsEntry()).filter(Boolean).length>0||[...l.dataTransfer?.files??[]].length>0}async function i(l){const r=[],a=[...l.dataTransfer?.items??[]].filter(n=>n.kind==="file").map(n=>n.webkitGetAsEntry()).filter(Boolean);if(a.length)for(const n of a){const u=await ne(n,le(".",n));r.push(...u.map(s=>s.file))}else r.push(...l.dataTransfer?.files??[]);return r}return{handleDrop:i,hasFilesOrFolders:e}}function ne(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new Promise((l,r)=>{e.isFile?e.file(n=>l([{file:n,path:i}]),r):e.isDirectory&&e.createReader().readEntries(async n=>{const u=[];for(const s of n)u.push(...await ne(s,le(i,s)));l(u)})})}function le(e,i){return i.isDirectory?`${e}/${i.name}`:e}const Qe=q({filterByType:String},"file-accept");function et(e){const i=h(()=>e.filterByType?tt(e.filterByType):null);function l(r){if(i.value){const a=r.filter(i.value);return{accepted:a,rejected:r.filter(n=>!a.includes(n))}}return{accepted:r,rejected:[]}}return{filterAccepted:l}}function tt(e){const i=e.split(",").map(n=>n.trim().toLowerCase()),l=i.filter(n=>n.startsWith(".")),r=i.filter(n=>n.endsWith("/*")),a=i.filter(n=>!l.includes(n)&&!r.includes(n));return n=>{const u=n.name.split(".").at(-1)?.toLowerCase()??"",s=n.type.split("/").at(0)?.toLowerCase()??"";return a.includes(n.type)||l.includes(`.${u}`)||r.includes(`${s}/*`)}}const nt=q({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(Number(e))},truncateLength:{type:[Number,String],default:22},...Ne({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>Z(e).every(i=>i!=null&&typeof i=="object")},...Qe(),...Me({clearable:!0})},"VFileInput"),lt=Be()({name:"VFileInput",inheritAttrs:!1,props:nt(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0,rejected:e=>!0},setup(e,i){let{attrs:l,emit:r,slots:a}=i;const{t:n}=Te(),{filterAccepted:u}=et(e),s=xe(e,"modelValue",e.modelValue,t=>Z(t),t=>!e.multiple&&Array.isArray(t)?t[0]:t),{isFocused:v,focus:S,blur:b}=ze(e),k=h(()=>typeof e.showSize!="boolean"?e.showSize:void 0),C=h(()=>(s.value??[]).reduce((t,o)=>{let{size:m=0}=o;return t+m},0)),$=h(()=>G(C.value,k.value)),B=h(()=>(s.value??[]).map(t=>{const{name:o="",size:m=0}=t,y=fe(o);return e.showSize?`${y} (${G(m,k.value)})`:y})),ae=h(()=>{const t=s.value?.length??0;return e.showSize?n(e.counterSizeString,t,$.value):n(e.counterString,t)}),_=D(),j=D(),d=D(),ie=Ae(()=>v.value||e.active),M=h(()=>["plain","underlined"].includes(e.variant)),F=Pe(!1),{handleDrop:re,hasFilesOrFolders:se}=Je();function T(){d.value!==document.activeElement&&d.value?.focus(),v.value||S()}function oe(t){d.value?.click()}function ue(t){r("mousedown:control",t)}function ce(t){d.value?.click(),r("click:control",t)}function de(t){t.stopPropagation(),T(),J(()=>{s.value=[],Oe(e["onClick:clear"],t)})}function fe(t){if(t.length<Number(e.truncateLength))return t;const o=Math.floor((Number(e.truncateLength)-1)/2);return`${t.slice(0,o)}…${t.slice(t.length-o)}`}function pe(t){t.preventDefault(),t.stopImmediatePropagation(),F.value=!0}function ve(t){t.preventDefault(),F.value=!1}async function me(t){if(t.preventDefault(),t.stopImmediatePropagation(),F.value=!1,!d.value||!se(t))return;const o=await re(t);N(o)}function ye(t){if(!(!t.target||t.repack))if(e.filterByType)N([...t.target.files]);else{const o=t.target;s.value=[...o.files??[]]}}function N(t){const o=new DataTransfer,{accepted:m,rejected:y}=u(t);y.length&&r("rejected",y);for(const z of m)o.items.add(z);d.value.files=o.files,s.value=[...o.files];const x=new Event("change",{bubbles:!0});x.repack=!0,d.value.dispatchEvent(x)}return Re(s,t=>{(!Array.isArray(t)||!t.length)&&d.value&&(d.value.value="")}),$e(()=>{const t=!!(a.counter||e.counter),o=!!(t||a.details),[m,y]=_e(l),{modelValue:x,...z}=U.filterProps(e),ge={...K.filterProps(e),"onClick:clear":de},he=l.webkitdirectory!==void 0&&l.webkitdirectory!==!1,be=l.accept?String(l.accept):void 0,ke=he?void 0:e.filterByType??be;return c(U,I({ref:_,modelValue:e.multiple?s.value:s.value[0],class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--dragging":F.value,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":M.value},e.class],style:e.style,"onClick:prepend":oe},m,z,{centerAffix:!M.value,focused:v.value}),{...a,default:A=>{let{id:Ce,isDisabled:E,isDirty:L,isReadonly:O,isValid:Fe,hasDetails:Ve}=A;return c(K,I({ref:j,prependIcon:e.prependIcon,onMousedown:ue,onClick:ce,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},ge,{id:Ce.value,active:ie.value||L.value,dirty:L.value||e.dirty,disabled:E.value,focused:v.value,details:Ve.value,error:Fe.value===!1,onDragover:pe,onDrop:me}),{...a,default:we=>{let{props:{class:De,...Ie},controlRef:Se}=we;return p(P,null,[p("input",I({ref:g=>d.value=Se.value=g,type:"file",accept:ke,readonly:O.value,disabled:E.value,multiple:e.multiple,name:e.name,onClick:g=>{g.stopPropagation(),O.value&&g.preventDefault(),T()},onChange:ye,onDragleave:ve,onFocus:T,onBlur:b},Ie,y),null),p("div",{class:Le(De)},[!!s.value?.length&&!e.hideInput&&(a.selection?a.selection({fileNames:B.value,totalBytes:C.value,totalBytesReadable:$.value}):e.chips?B.value.map(g=>c(Xe,{key:g,size:"small",text:g},null)):B.value.join(", "))])])}})},details:o?A=>p(P,null,[a.details?.(A),t&&p(P,null,[p("span",null,null),c(Ee,{active:!!s.value?.length,value:ae.value,disabled:e.disabled},a.counter)])]):void 0})}),je({},_,j,d)}}),R=5e6,st=Q({__name:"FileInput",props:{label:{}},emits:["update"],setup(e,{expose:i,emit:l}){const r=e,a=l,n=D(null);function u(b){return b?b.size<=R||`Taille maximale : ${R/1e6}MB`:!0}function s(){n.value&&n.value.size>R||a("update",n.value)}i({openDialog:S});const v=Ge("input");function S(){J(()=>v.value?.click())}return(b,k)=>(te(),ee(lt,{label:r.label,density:"comfortable",accept:".jpg,.jpeg,.png,.pdf",multiple:!1,modelValue:n.value,"onUpdate:modelValue":[k[0]||(k[0]=C=>n.value=C),s],rules:[u],"show-size":"",ref_key:"input",ref:v},null,8,["label","modelValue","rules"]))}}),at={class:"text-right ml-2"},ot=Q({__name:"FileCard",props:{file:{},readonly:{type:Boolean}},emits:["delete"],setup(e,{emit:i}){const l=e,r=i;return(a,n)=>(te(),ee(Ye,null,{activator:f(({props:u})=>[c(W,I({class:"my-2"},u),{default:f(()=>[c(He,{cover:"",src:V(Y).LoadMiniature(l.file.Key),width:"56px"},null,8,["src"])]),_:1},16)]),default:f(()=>[c(W,null,{default:f(()=>[c(Ue,{class:"px-0"},{default:f(()=>[c(qe,{"min-width":"400",title:l.file.NomClient,subtitle:V(H).size(l.file.Taille)},{append:f(()=>[p("div",at,[n[1]||(n[1]=w(" téléversé le ",-1)),n[2]||(n[2]=p("br",null,null,-1)),w(" "+Ke(V(H).time(l.file.Uploaded)),1)])]),_:1},8,["title","subtitle"])]),_:1}),c(We,null,{default:f(()=>[c(X,{onClick:n[0]||(n[0]=u=>r("delete")),color:"red"},{default:f(()=>[...n[3]||(n[3]=[w(" Supprimer ",-1)])]),_:1}),c(Ze),c(X,{href:V(Y).LoadDocument(l.file.Key)},{default:f(()=>[...n[4]||(n[4]=[w(" Télécharger ",-1)])]),_:1},8,["href"])]),_:1})]),_:1})]),_:1}))}});export{ot as _,st as a};
