import{Ai as e,B as t,Bi as n,Ea as r,Ei as i,Fi as a,Gi as o,H as s,Ii as c,Jt as l,Kt as u,Li as d,M as f,Mi as p,Ni as m,O as h,Pi as g,Qi as ee,Qn as _,Qt as v,Ri as y,Sa as b,St as x,U as S,Ut as C,V as w,Zn as T,ea as E,gt as D,ha as O,i as te,ji as ne,k,ki as A,n as j,na as re,nn as M,pa as ie,r as N,rt as P,t as F,u as I,ua as L,z as R,zi as z}from"./VSnackbar-DKsX373a.js";import{b as ae,m as oe,o as se,s as B,t as ce,u as V,v as H,x as U,y as le}from"./VSelect-DKlba4X0.js";import{t as W}from"./MontantField-DerzTMqX.js";import{n as ue,r as G,t as de}from"./ModePaiementField-B7FaPc2b.js";import"./VBadge-BaNiUdH_.js";import"./VPicker-Bbu7JWFU.js";import"./VSheet-CF2FMydG.js";import{t as K}from"./VDialog-491dXdoo.js";import{t as fe}from"./VTooltip-05sJRP7O.js";import{t as pe}from"./VCombobox-BiNZw4JF.js";const q={Euros:0,FrancsSuisse:1};q.Euros,q.FrancsSuisse;const J={Cheque:0,EnLigne:1,Virement:2,Especes:3,Ancv:4,Helloasso:5},me={[J.Cheque]:`Chèque`,[J.EnLigne]:`Carte bancaire (en ligne)`,[J.Virement]:`Virement`,[J.Especes]:`Espèces`,[J.Ancv]:`ANCV`,[J.Helloasso]:`Helloasso`},Y={NoSexe:0,Woman:1,Man:2};Y.NoSexe,Y.Woman,Y.Man;var X=class{constructor(e,t){this.baseURL=e,this.authToken=t}getHeaders(){return{Authorization:`Bearer `+this.authToken}}async Loggin(e){let t=this.baseURL+`/api/v1/loggin`;this.startRequest();try{return(await T.get(t,{headers:this.getHeaders(),params:{password:e.password}})).data}catch(e){this.handleError(e)}}async LoadDons(){let e=this.baseURL+`/api/v1/dons`;this.startRequest();try{return(await T.get(e,{headers:this.getHeaders()})).data}catch(e){this.handleError(e)}}async UpdateDon(e){let t=this.baseURL+`/api/v1/dons`;this.startRequest();try{return await T.post(t,e,{headers:this.getHeaders()}),!0}catch(e){this.handleError(e)}}async CreateDon(e){let t=this.baseURL+`/api/v1/dons`;this.startRequest();try{return(await T.put(t,e,{headers:this.getHeaders()})).data}catch(e){this.handleError(e)}}async DeleteDon(e){let t=this.baseURL+`/api/v1/dons`;this.startRequest();try{return await T.delete(t,{headers:this.getHeaders(),params:{id:String(e.id)}}),!0}catch(e){this.handleError(e)}}async SearchPersonnes(e){let t=this.baseURL+`/api/v1/dons/search-personnes`;this.startRequest();try{return(await T.get(t,{headers:this.getHeaders(),params:{search:e.search}})).data}catch(e){this.handleError(e)}}async SearchOrganismes(e){let t=this.baseURL+`/api/v1/dons/search-organismes`;this.startRequest();try{return(await T.get(t,{headers:this.getHeaders(),params:{search:e.search}})).data}catch(e){this.handleError(e)}}DownloadRecusFiscaux(e,t){return this.baseURL+`/api/v1/dons/download-recus-fiscaux?year=${e}&token=${t}`}DownloadDonsExcel(e,t){return this.baseURL+`/api/v1/dons/download-dons?year=${e}&token=${t}`}};const Z=new class extends X{constructor(e,t,n){super(n,``),this.onError=e,this.showMessage=t}handleError(e){let{kind:t,messageHtml:n}=M(e);this.onError(t,n)}startRequest(){}setToken(e){this.authToken=e}}((e,t)=>{},(e,t)=>{},u());var he=n({__name:`LogginPage`,emits:[`enter`],setup(t,{emit:n}){let r=n,i=O(!1),a=O(``),o=O([]);async function s(){let e=await Z.Loggin({password:a.value});e!==void 0&&(e.IsValid?(Z.setToken(e.Token),Z.showMessage(`Bienvenue !`),r(`enter`)):o.value=[`Clé de connection incorrecte.`])}return(t,n)=>(E(),g(w,{class:`fill-height`},{default:L(()=>[z(h,{class:`mx-auto`,width:`400px`},{default:L(()=>[z(k,null,{default:L(()=>[m(`form`,null,[z(I,{label:`Clé de connection`,modelValue:a.value,"onUpdate:modelValue":n[1]||=e=>a.value=e,"error-messages":o.value,type:i.value?void 0:`password`,name:`password`,onKeydown:n[2]||=A(e(()=>a.value.length==0?null:s(),[`prevent`]),[`enter`]),autocomplete:`current-password`},{"append-inner":L(()=>[z(S,{class:`ml-2`,size:`small`,icon:i.value?`mdi-eye`:`mdi-eye-off`,flat:``,onClick:n[0]||=e=>i.value=!i.value},null,8,[`icon`])]),_:1},8,[`modelValue`,`error-messages`,`type`])])]),_:1}),z(f,null,{default:L(()=>[z(U),z(S,{disabled:!a.value.length,onClick:s},{default:L(()=>[...n[3]||=[y(`Se connecter`,-1)]]),_:1},8,[`disabled`])]),_:1})]),_:1})]),_:1}))}}),ge=n({__name:`DonPannel`,props:{don:{},affectationHints:{}},emits:[`save`],setup(e,{emit:n}){let r=e,i=n,a=O(l(r.don));return(e,n)=>{let o=W,s=de,c=G;return E(),g(h,{title:`Modifier le don`},{append:L(()=>[...n[7]||=[]]),default:L(()=>[z(k,null,{default:L(()=>[z(R,null,{default:L(()=>[z(t)]),_:1}),z(R,null,{default:L(()=>[z(t,null,{default:L(()=>[z(o,{modelValue:a.value.Montant,"onUpdate:modelValue":n[0]||=e=>a.value.Montant=e,label:`Montant`},null,8,[`modelValue`])]),_:1}),z(t,null,{default:L(()=>[z(s,{modelValue:a.value.ModePaiement,"onUpdate:modelValue":n[1]||=e=>a.value.ModePaiement=e},null,8,[`modelValue`])]),_:1})]),_:1}),z(R,null,{default:L(()=>[z(t,null,{default:L(()=>[z(I,{modelValue:a.value.Details,"onUpdate:modelValue":n[2]||=e=>a.value.Details=e,label:`Détails`,density:`compact`,variant:`outlined`},null,8,[`modelValue`])]),_:1}),z(t,null,{default:L(()=>[z(pe,{label:`Affectation`,items:r.affectationHints,modelValue:a.value.Affectation,"onUpdate:modelValue":n[3]||=e=>a.value.Affectation=e,density:`compact`,variant:`outlined`},null,8,[`items`,`modelValue`])]),_:1})]),_:1}),z(R,null,{default:L(()=>[z(t,null,{default:L(()=>[z(c,{modelValue:a.value.Date,"onUpdate:modelValue":n[4]||=e=>a.value.Date=e,label:`Date`},null,8,[`modelValue`])]),_:1}),z(t,null,{default:L(()=>[z(V,{density:`compact`,modelValue:a.value.Remercie,"onUpdate:modelValue":n[5]||=e=>a.value.Remercie=e,label:`Remercié ?`,"hide-details":``},null,8,[`modelValue`])]),_:1})]),_:1})]),_:1}),z(f,null,{default:L(()=>[z(U),z(S,{onClick:n[6]||=e=>i(`save`,a.value)},{default:L(()=>[...n[8]||=[y(`Enregistrer`,-1)]]),_:1})]),_:1})]),_:1})}}}),Q=16,_e=n({__name:`DonsV`,emits:[`update:selectedYear`],setup(e,{emit:n}){let i=n;ee(()=>{M(),i(`update:selectedYear`,D())});let s=O(null),l=p(()=>Array.from(new Set(s.value?.Dons?.map(e=>e.Don.Affectation)).keys()).filter(e=>e!=``).sort()),u=ie({pattern:``,year:D()}),d=p(()=>{let e=v(u.pattern),t=(s.value?.Dons||[]).filter(t=>new Date(t.Don.Date).getFullYear()==u.year&&(e==``||v(t.Donateur).includes(e)||v(t.Don.Details).includes(e)));return t.sort((e,t)=>{let n=new Date(t.Don.Date).valueOf(),r=new Date(e.Don.Date).valueOf();return n==r?e.Don.Id-t.Don.Id:n-r}),t}),_=p(()=>d.value.slice((T.value-1)*Q,T.value*Q));function x(){T.value>w.value&&(T.value=w.value)}let w=p(()=>Math.max(Math.ceil(d.value.length/Q),1)),T=O(1);function D(){return new Date(Date.now()).getFullYear()}let A=p(()=>{let e=new Set(Object.keys(s.value?.YearTotals||{}).map(Number));return e.add(D()),Array.from(e.keys()).sort()}),j=p(()=>(s.value?.YearTotals||{})[u.year]||{Particuliers:``,Organismes:``});async function M(){let e=await Z.LoadDons();e!==void 0&&(s.value=e||[],x())}let N=O(null);async function F(e){N.value=null,await Z.UpdateDon(e)!==void 0&&(Z.showMessage(`Don modifié avec succès.`),M())}let V=O(null);async function W(){if(!V.value)return;let e=V.value;V.value=null,await Z.DeleteDon({id:e.Don.Id})!==void 0&&(Z.showMessage(`Don supprimé avec succès.`),M())}async function G(e){e.Remercie=!e.Remercie,await Z.UpdateDon(e)!==void 0&&(Z.showMessage(`Don modifié avec succès.`),x())}return(e,n)=>s.value==null?(E(),g(te,{key:0,type:`table`})):(E(),g(h,{key:1,title:`Dons`,subtitle:d.value.length==s.value.Dons?.length?`${s.value.Dons.length}`:`${d.value.length} visibles sur ${s.value.Dons?.length}`,width:`100%`},{append:L(()=>[z(R,null,{default:L(()=>[z(t,{"align-self":`center`},{default:L(()=>[z(B,null,{default:L(()=>[y(`Total annuel particuliers `+r(j.value.Particuliers),1)]),_:1})]),_:1}),z(t,{"align-self":`center`},{default:L(()=>[z(B,null,{default:L(()=>[y(`Total annuel organismes `+r(j.value.Organismes),1)]),_:1})]),_:1}),z(t,null,{default:L(()=>[z(I,{width:`200px`,label:`Recherche`,variant:`outlined`,density:`compact`,"hide-details":``,placeholder:`Rechercher...`,clearable:``,"onClick:clear":n[0]||=e=>u.pattern=``,modelValue:u.pattern,"onUpdate:modelValue":n[1]||=e=>u.pattern=e},null,8,[`modelValue`])]),_:1}),z(t,null,{default:L(()=>[z(ce,{label:`Année`,modelValue:u.year,"onUpdate:modelValue":[n[2]||=e=>u.year=e,n[3]||=e=>i(`update:selectedYear`,e)],variant:`outlined`,density:`compact`,items:A.value,"hide-details":``},null,8,[`modelValue`,`items`])]),_:1})]),_:1})]),default:L(()=>[z(k,{class:`mt-2`},{default:L(()=>[_.value.length?a(``,!0):(E(),g(H,{key:0},{default:L(()=>[...n[7]||=[m(`i`,null,`Aucun don.`,-1)]]),_:1})),(E(!0),c(ne,null,re(_.value,e=>(E(),g(R,null,{default:L(()=>[z(t,{cols:`auto`,"align-self":`center`},{default:L(()=>[z(P,{icon:e.Don.IdPersonne.Valid?``:`mdi-account-group`},null,8,[`icon`])]),_:2},1024),z(t,{cols:`5`,"align-self":`center`},{default:L(()=>[z(le,null,{default:L(()=>[y(r(e.Donateur),1)]),_:2},1024),z(ae,null,{default:L(()=>[y(r([e.Don.Affectation,e.Don.Details].filter(e=>e).join(` ; `)),1)]),_:2},1024)]),_:2},1024),z(t,{"align-self":`center`,class:`text-center`},{default:L(()=>[z(B,{variant:`outlined`},{default:L(()=>[y(r(e.Montant),1)]),_:2},1024)]),_:2},1024),z(t,{"align-self":`center`,cols:`1`,class:`text-center`},{default:L(()=>[z(fe,null,{activator:L(({props:t})=>[z(P,o({ref_for:!0},t,{icon:b(C).paiementIcon(e.Don.ModePaiement)}),null,16,[`icon`])]),default:L(()=>[y(` `+r(b(me)[e.Don.ModePaiement]),1)]),_:2},1024)]),_:2},1024),z(t,{"align-self":`center`,class:`text-center`},{default:L(()=>[y(r(b(C).date(e.Don.Date,!0,!1)),1)]),_:2},1024),z(t,{"align-self":`center`,class:`text-center`,cols:`auto`},{default:L(()=>[z(B,{color:e.Don.Remercie?`green`:`orange`,"prepend-icon":e.Don.Remercie?`mdi-check`:``,elevation:`1`,onClick:t=>G(e.Don)},{default:L(()=>[y(r(e.Don.Remercie?`Remercié`:`À remercier`),1)]),_:2},1032,[`color`,`prepend-icon`,`onClick`])]),_:2},1024),z(t,{cols:`auto`},{default:L(()=>[z(S,{icon:``,size:`small`,flat:``},{default:L(()=>[z(P,null,{default:L(()=>[...n[8]||=[y(`mdi-dots-vertical`,-1)]]),_:1}),z(se,{activator:`parent`},{default:L(()=>[z(oe,{density:`compact`},{default:L(()=>[z(H,{title:`Modifier`,"prepend-icon":`mdi-pencil`,onClick:t=>N.value=e.Don},null,8,[`onClick`]),z(H,{title:`Supprimer`,"prepend-icon":`mdi-delete`,onClick:t=>V.value=e},null,8,[`onClick`])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),256)),z(ue,{length:w.value,modelValue:T.value,"onUpdate:modelValue":n[4]||=e=>T.value=e},null,8,[`length`,`modelValue`])]),_:1}),z(K,{"model-value":N.value!=null,"onUpdate:modelValue":n[5]||=e=>N.value=null,"max-width":`600px`},{default:L(()=>[N.value?(E(),g(ge,{key:0,don:N.value,"affectation-hints":l.value,onSave:F},null,8,[`don`,`affectation-hints`])):a(``,!0)]),_:1},8,[`model-value`]),z(K,{"model-value":V.value!=null,"onUpdate:modelValue":n[6]||=e=>V.value=null,"max-width":`600px`},{default:L(()=>[V.value?(E(),g(h,{key:0,title:`Confirmation`},{default:L(()=>[z(k,null,{default:L(()=>[y(`Confirmez-vous la suppression du don de `+r(V.value.Donateur)+` d'un montant de `+r(V.value.Montant)+` ? `,1),n[9]||=m(`br`,null,null,-1),n[10]||=m(`br`,null,null,-1),n[11]||=y(` Attention, cette opération est irréversible.`,-1)]),_:1}),z(f,null,{default:L(()=>[z(U),z(S,{color:`red`,onClick:W},{default:L(()=>[...n[12]||=[y(`Supprimer`,-1)]]),_:1})]),_:1})]),_:1})):a(``,!0)]),_:1},8,[`model-value`])]),_:1},8,[`subtitle`]))}}),ve=[`innerHTML`],$=i(n({__name:`App`,setup(e){let n=O(``),i=O(`primary`),a=O(``),o=O(``);Z.onError=(e,t)=>{a.value=e,o.value=t},Z.showMessage=(e,t)=>{n.value=e,i.value=t||`success`};let c=O(!1),l=O(0),u=O(!1);function f(){u.value=!0,setTimeout(()=>u.value=!1,3e3)}return(e,p)=>(E(),g(N,null,{default:L(()=>[z(j,null,{default:L(()=>[z(D,{rounded:``,elevation:`4`,color:`primary`},d({default:L(()=>[z(s,null,{default:L(()=>[z(R,null,{default:L(()=>[z(t,{"align-self":`center`,cols:`auto`},{default:L(()=>[z(x,{width:`150`,src:`/static/acve/logo.png`})]),_:1}),z(t,{"align-self":`center`},{default:L(()=>[...p[4]||=[y(` Gestion des dons `,-1)]]),_:1})]),_:1})]),_:1})]),_:2},[c.value?{name:`append`,fn:L(()=>[z(S,{"prepend-icon":`mdi-download`,href:b(Z).DownloadDonsExcel(l.value,b(Z).authToken)},{default:L(()=>[...p[5]||=[y(`Exporter`,-1)]]),_:1},8,[`href`]),z(S,{"prepend-icon":`mdi-receipt-text`,href:b(Z).DownloadRecusFiscaux(l.value,b(Z).authToken),disabled:u.value,onClick:f},{default:L(()=>[...p[6]||=[y(`Télécharger les reçus fiscaux`,-1)]]),_:1},8,[`href`,`disabled`])]),key:`0`}:void 0]),1024),z(w,{class:`fill-height`},{default:L(()=>[c.value?(E(),g(_e,{key:1,"onUpdate:selectedYear":p[1]||=e=>l.value=e})):(E(),g(he,{key:0,onEnter:p[0]||=e=>c.value=!0}))]),_:1}),z(F,{style:{"z-index":`10000`},app:``,"model-value":n.value!=``,"onUpdate:modelValue":p[2]||=e=>n.value=``,timeout:4e3,color:i.value,location:`bottom left`,"close-on-content-click":``},{default:L(()=>[y(r(n.value),1)]),_:1},8,[`model-value`,`color`]),z(F,{app:``,"model-value":a.value!=``,"onUpdate:modelValue":p[3]||=e=>a.value=``,timeout:4e3,color:`red`},{default:L(()=>[m(`b`,null,r(a.value),1),m(`div`,{innerHTML:o.value},null,8,ve)]),_:1},8,[`model-value`])]),_:1})]),_:1}))}}));$.use(_),$.mount(`#app`);