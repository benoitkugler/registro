import{$i as e,Ai as t,B as n,Fi as r,H as i,Ii as a,Jt as o,Kt as s,Li as c,M as l,Mi as u,Ni as d,O as f,Oi as p,Pi as m,Qt as h,Ri as g,St as _,Ta as v,Ti as y,U as b,Ut as x,V as S,Wi as ee,Xn as C,Zi as te,Zn as w,fa as ne,gt as T,i as re,ji as E,k as D,ki as O,la as k,ma as A,n as j,nn as M,r as N,rt as P,t as F,ta as ie,u as I,xa as L,z as R,zi as z}from"./VSnackbar-CDqA4E7r.js";import{b as ae,m as oe,o as se,s as B,t as ce,u as V,v as H,x as U,y as le}from"./VSelect-DWxc8fzS.js";import{t as W}from"./MontantField-WQd8Ip-V.js";import{n as ue,r as G,t as de}from"./ModePaiementField-sCeWoy6m.js";import"./VBadge-BVZ-SwOt.js";import"./VPicker-BqWr9f9F.js";import"./VSheet-DfbVBByY.js";import{t as K}from"./VDialog-DXT_H6_Q.js";import{t as fe}from"./VTooltip-cqJpmucA.js";import{t as pe}from"./VCombobox-D6D0WNoP.js";const q={Euros:0,FrancsSuisse:1};q.Euros,q.FrancsSuisse;const J={Cheque:0,EnLigne:1,Virement:2,Especes:3,Ancv:4,Helloasso:5},me={[J.Cheque]:`Chèque`,[J.EnLigne]:`Carte bancaire (en ligne)`,[J.Virement]:`Virement`,[J.Especes]:`Espèces`,[J.Ancv]:`ANCV`,[J.Helloasso]:`Helloasso`},Y={NoSexe:0,Woman:1,Man:2};Y.NoSexe,Y.Woman,Y.Man;var he=class{constructor(e,t){this.baseURL=e,this.authToken=t}getHeaders(){return{Authorization:`Bearer `+this.authToken}}async Loggin(e){let t=this.baseURL+`/api/v1/loggin`;this.startRequest();try{return(await C.get(t,{headers:this.getHeaders(),params:{password:e.password}})).data}catch(e){this.handleError(e)}}async LoadDons(){let e=this.baseURL+`/api/v1/dons`;this.startRequest();try{return(await C.get(e,{headers:this.getHeaders()})).data}catch(e){this.handleError(e)}}async UpdateDon(e){let t=this.baseURL+`/api/v1/dons`;this.startRequest();try{return await C.post(t,e,{headers:this.getHeaders()}),!0}catch(e){this.handleError(e)}}async CreateDon(e){let t=this.baseURL+`/api/v1/dons`;this.startRequest();try{return(await C.put(t,e,{headers:this.getHeaders()})).data}catch(e){this.handleError(e)}}async DeleteDon(e){let t=this.baseURL+`/api/v1/dons`;this.startRequest();try{return await C.delete(t,{headers:this.getHeaders(),params:{id:String(e.id)}}),!0}catch(e){this.handleError(e)}}async SearchPersonnes(e){let t=this.baseURL+`/api/v1/dons/search-personnes`;this.startRequest();try{return(await C.get(t,{headers:this.getHeaders(),params:{search:e.search}})).data}catch(e){this.handleError(e)}}async SearchOrganismes(e){let t=this.baseURL+`/api/v1/dons/search-organismes`;this.startRequest();try{return(await C.get(t,{headers:this.getHeaders(),params:{search:e.search}})).data}catch(e){this.handleError(e)}}DownloadRecusFiscaux(e,t){return this.baseURL+`/api/v1/dons/download-recus-fiscaux?year=${e}&token=${t}`}DownloadDonsExcel(e,t){return this.baseURL+`/api/v1/dons/download-dons?year=${e}&token=${t}`}};const X=new class extends he{constructor(e,t,n){super(n,``),this.onError=e,this.showMessage=t}handleError(e){let{kind:t,messageHtml:n}=M(e);this.onError(t,n)}startRequest(){}setToken(e){this.authToken=e}}((e,t)=>{},(e,t)=>{},s());var ge=z({__name:`LogginPage`,emits:[`enter`],setup(t,{emit:n}){let r=n,i=A(!1),a=A(``),o=A([]);async function s(){let e=await X.Loggin({password:a.value});e!==void 0&&(e.IsValid?(X.setToken(e.Token),X.showMessage(`Bienvenue !`),r(`enter`)):o.value=[`Clé de connection incorrecte.`])}return(t,n)=>(e(),d(S,{class:`fill-height`},{default:k(()=>[g(f,{class:`mx-auto`,width:`400px`},{default:k(()=>[g(D,null,{default:k(()=>[u(`form`,null,[g(I,{label:`Clé de connection`,modelValue:a.value,"onUpdate:modelValue":n[1]||=e=>a.value=e,"error-messages":o.value,type:i.value?void 0:`password`,name:`password`,onKeydown:n[2]||=p(O(()=>a.value.length==0?null:s(),[`prevent`]),[`enter`]),autocomplete:`current-password`},{"append-inner":k(()=>[g(b,{class:`ml-2`,size:`small`,icon:i.value?`mdi-eye`:`mdi-eye-off`,flat:``,onClick:n[0]||=e=>i.value=!i.value},null,8,[`icon`])]),_:1},8,[`modelValue`,`error-messages`,`type`])])]),_:1}),g(l,null,{default:k(()=>[g(U),g(b,{disabled:!a.value.length,onClick:s},{default:k(()=>[...n[3]||=[c(`Se connecter`,-1)]]),_:1},8,[`disabled`])]),_:1})]),_:1})]),_:1}))}}),Z=z({__name:`DonPannel`,props:{don:{},affectationHints:{}},emits:[`save`],setup(t,{emit:r}){let i=t,a=r,s=A(o(i.don));return(t,r)=>{let o=W,u=de,p=G;return e(),d(f,{title:`Modifier le don`},{append:k(()=>[...r[7]||=[]]),default:k(()=>[g(D,null,{default:k(()=>[g(R,null,{default:k(()=>[g(n)]),_:1}),g(R,null,{default:k(()=>[g(n,null,{default:k(()=>[g(o,{modelValue:s.value.Montant,"onUpdate:modelValue":r[0]||=e=>s.value.Montant=e,label:`Montant`},null,8,[`modelValue`])]),_:1}),g(n,null,{default:k(()=>[g(u,{modelValue:s.value.ModePaiement,"onUpdate:modelValue":r[1]||=e=>s.value.ModePaiement=e},null,8,[`modelValue`])]),_:1})]),_:1}),g(R,null,{default:k(()=>[g(n,null,{default:k(()=>[g(I,{modelValue:s.value.Details,"onUpdate:modelValue":r[2]||=e=>s.value.Details=e,label:`Détails`,density:`compact`,variant:`outlined`},null,8,[`modelValue`])]),_:1}),g(n,null,{default:k(()=>[g(pe,{label:`Affectation`,items:i.affectationHints,modelValue:s.value.Affectation,"onUpdate:modelValue":r[3]||=e=>s.value.Affectation=e,density:`compact`,variant:`outlined`},null,8,[`items`,`modelValue`])]),_:1})]),_:1}),g(R,null,{default:k(()=>[g(n,null,{default:k(()=>[g(p,{modelValue:s.value.Date,"onUpdate:modelValue":r[4]||=e=>s.value.Date=e,label:`Date`},null,8,[`modelValue`])]),_:1}),g(n,null,{default:k(()=>[g(V,{density:`compact`,modelValue:s.value.Remercie,"onUpdate:modelValue":r[5]||=e=>s.value.Remercie=e,label:`Remercié ?`,"hide-details":``},null,8,[`modelValue`])]),_:1})]),_:1})]),_:1}),g(l,null,{default:k(()=>[g(U),g(b,{onClick:r[6]||=e=>a(`save`,s.value)},{default:k(()=>[...r[8]||=[c(`Enregistrer`,-1)]]),_:1})]),_:1})]),_:1})}}}),Q=16,_e=z({__name:`DonsV`,emits:[`update:selectedYear`],setup(i,{emit:a}){let o=a;te(()=>{N(),o(`update:selectedYear`,O())});let s=A(null),p=E(()=>Array.from(new Set(s.value?.Dons?.map(e=>e.Don.Affectation)).keys()).filter(e=>e!=``).sort()),_=ne({pattern:``,year:O()}),y=E(()=>{let e=h(_.pattern),t=(s.value?.Dons||[]).filter(t=>new Date(t.Don.Date).getFullYear()==_.year&&(e==``||h(t.Donateur).includes(e)||h(t.Don.Details).includes(e)));return t.sort((e,t)=>{let n=new Date(t.Don.Date).valueOf(),r=new Date(e.Don.Date).valueOf();return n==r?e.Don.Id-t.Don.Id:n-r}),t}),S=E(()=>y.value.slice((T.value-1)*Q,T.value*Q));function C(){T.value>w.value&&(T.value=w.value)}let w=E(()=>Math.max(Math.ceil(y.value.length/Q),1)),T=A(1);function O(){return new Date(Date.now()).getFullYear()}let j=E(()=>{let e=new Set(Object.keys(s.value?.YearTotals||{}).map(Number));return e.add(O()),Array.from(e.keys()).sort()}),M=E(()=>(s.value?.YearTotals||{})[_.year]||{Particuliers:``,Organismes:``});async function N(){let e=await X.LoadDons();e!==void 0&&(s.value=e||[],C())}let F=A(null);async function z(e){F.value=null,await X.UpdateDon(e)!==void 0&&(X.showMessage(`Don modifié avec succès.`),N())}let V=A(null);async function W(){if(!V.value)return;let e=V.value;V.value=null,await X.DeleteDon({id:e.Don.Id})!==void 0&&(X.showMessage(`Don supprimé avec succès.`),N())}async function G(e){e.Remercie=!e.Remercie,await X.UpdateDon(e)!==void 0&&(X.showMessage(`Don modifié avec succès.`),C())}return(i,a)=>s.value==null?(e(),d(re,{key:0,type:`table`})):(e(),d(f,{key:1,title:`Dons`,subtitle:y.value.length==s.value.Dons?.length?`${s.value.Dons.length}`:`${y.value.length} visibles sur ${s.value.Dons?.length}`,width:`100%`},{append:k(()=>[g(R,null,{default:k(()=>[g(n,{"align-self":`center`},{default:k(()=>[g(B,null,{default:k(()=>[c(`Total annuel particuliers `+v(M.value.Particuliers),1)]),_:1})]),_:1}),g(n,{"align-self":`center`},{default:k(()=>[g(B,null,{default:k(()=>[c(`Total annuel organismes `+v(M.value.Organismes),1)]),_:1})]),_:1}),g(n,null,{default:k(()=>[g(I,{width:`200px`,label:`Recherche`,variant:`outlined`,density:`compact`,"hide-details":``,placeholder:`Rechercher...`,clearable:``,"onClick:clear":a[0]||=e=>_.pattern=``,modelValue:_.pattern,"onUpdate:modelValue":a[1]||=e=>_.pattern=e},null,8,[`modelValue`])]),_:1}),g(n,null,{default:k(()=>[g(ce,{label:`Année`,modelValue:_.year,"onUpdate:modelValue":[a[2]||=e=>_.year=e,a[3]||=e=>o(`update:selectedYear`,e)],variant:`outlined`,density:`compact`,items:j.value,"hide-details":``},null,8,[`modelValue`,`items`])]),_:1})]),_:1})]),default:k(()=>[g(D,{class:`mt-2`},{default:k(()=>[S.value.length?m(``,!0):(e(),d(H,{key:0},{default:k(()=>[...a[7]||=[u(`i`,null,`Aucun don.`,-1)]]),_:1})),(e(!0),r(t,null,ie(S.value,t=>(e(),d(R,null,{default:k(()=>[g(n,{cols:`auto`,"align-self":`center`},{default:k(()=>[g(P,{icon:t.Don.IdPersonne.Valid?``:`mdi-account-group`},null,8,[`icon`])]),_:2},1024),g(n,{cols:`5`,"align-self":`center`},{default:k(()=>[g(le,null,{default:k(()=>[c(v(t.Donateur),1)]),_:2},1024),g(ae,null,{default:k(()=>[c(v([t.Don.Affectation,t.Don.Details].filter(e=>e).join(` ; `)),1)]),_:2},1024)]),_:2},1024),g(n,{"align-self":`center`,class:`text-center`},{default:k(()=>[g(B,{variant:`outlined`},{default:k(()=>[c(v(t.Montant),1)]),_:2},1024)]),_:2},1024),g(n,{"align-self":`center`,cols:`1`,class:`text-center`},{default:k(()=>[g(fe,null,{activator:k(({props:e})=>[g(P,ee({ref_for:!0},e,{icon:L(x).paiementIcon(t.Don.ModePaiement)}),null,16,[`icon`])]),default:k(()=>[c(` `+v(L(me)[t.Don.ModePaiement]),1)]),_:2},1024)]),_:2},1024),g(n,{"align-self":`center`,class:`text-center`},{default:k(()=>[c(v(L(x).date(t.Don.Date,!0,!1)),1)]),_:2},1024),g(n,{"align-self":`center`,class:`text-center`,cols:`auto`},{default:k(()=>[g(B,{color:t.Don.Remercie?`green`:`orange`,"prepend-icon":t.Don.Remercie?`mdi-check`:``,elevation:`1`,onClick:e=>G(t.Don)},{default:k(()=>[c(v(t.Don.Remercie?`Remercié`:`À remercier`),1)]),_:2},1032,[`color`,`prepend-icon`,`onClick`])]),_:2},1024),g(n,{cols:`auto`},{default:k(()=>[g(b,{icon:``,size:`small`,flat:``},{default:k(()=>[g(P,null,{default:k(()=>[...a[8]||=[c(`mdi-dots-vertical`,-1)]]),_:1}),g(se,{activator:`parent`},{default:k(()=>[g(oe,{density:`compact`},{default:k(()=>[g(H,{title:`Modifier`,"prepend-icon":`mdi-pencil`,onClick:e=>F.value=t.Don},null,8,[`onClick`]),g(H,{title:`Supprimer`,"prepend-icon":`mdi-delete`,onClick:e=>V.value=t},null,8,[`onClick`])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),256)),g(ue,{length:w.value,modelValue:T.value,"onUpdate:modelValue":a[4]||=e=>T.value=e},null,8,[`length`,`modelValue`])]),_:1}),g(K,{"model-value":F.value!=null,"onUpdate:modelValue":a[5]||=e=>F.value=null,"max-width":`600px`},{default:k(()=>[F.value?(e(),d(Z,{key:0,don:F.value,"affectation-hints":p.value,onSave:z},null,8,[`don`,`affectation-hints`])):m(``,!0)]),_:1},8,[`model-value`]),g(K,{"model-value":V.value!=null,"onUpdate:modelValue":a[6]||=e=>V.value=null,"max-width":`600px`},{default:k(()=>[V.value?(e(),d(f,{key:0,title:`Confirmation`},{default:k(()=>[g(D,null,{default:k(()=>[c(`Confirmez-vous la suppression du don de `+v(V.value.Donateur)+` d'un montant de `+v(V.value.Montant)+` ? `,1),a[9]||=u(`br`,null,null,-1),a[10]||=u(`br`,null,null,-1),a[11]||=c(` Attention, cette opération est irréversible.`,-1)]),_:1}),g(l,null,{default:k(()=>[g(U),g(b,{color:`red`,onClick:W},{default:k(()=>[...a[12]||=[c(`Supprimer`,-1)]]),_:1})]),_:1})]),_:1})):m(``,!0)]),_:1},8,[`model-value`])]),_:1},8,[`subtitle`]))}}),ve=[`innerHTML`],$=y(z({__name:`App`,setup(t){let r=A(``),o=A(`primary`),s=A(``),l=A(``);X.onError=(e,t)=>{s.value=e,l.value=t},X.showMessage=(e,t)=>{r.value=e,o.value=t||`success`};let f=A(!1),p=A(0),m=A(!1);function h(){m.value=!0,setTimeout(()=>m.value=!1,3e3)}return(t,y)=>(e(),d(N,null,{default:k(()=>[g(j,null,{default:k(()=>[g(T,{rounded:``,elevation:`4`,color:`primary`},a({default:k(()=>[g(i,null,{default:k(()=>[g(R,null,{default:k(()=>[g(n,{"align-self":`center`,cols:`auto`},{default:k(()=>[g(_,{width:`150`,src:`/static/acve/logo.png`})]),_:1}),g(n,{"align-self":`center`},{default:k(()=>[...y[4]||=[c(` Gestion des dons `,-1)]]),_:1})]),_:1})]),_:1})]),_:2},[f.value?{name:`append`,fn:k(()=>[g(b,{"prepend-icon":`mdi-download`,href:L(X).DownloadDonsExcel(p.value,L(X).authToken)},{default:k(()=>[...y[5]||=[c(`Exporter`,-1)]]),_:1},8,[`href`]),g(b,{"prepend-icon":`mdi-receipt-text`,href:L(X).DownloadRecusFiscaux(p.value,L(X).authToken),disabled:m.value,onClick:h},{default:k(()=>[...y[6]||=[c(`Télécharger les reçus fiscaux`,-1)]]),_:1},8,[`href`,`disabled`])]),key:`0`}:void 0]),1024),g(S,{class:`fill-height`},{default:k(()=>[f.value?(e(),d(_e,{key:1,"onUpdate:selectedYear":y[1]||=e=>p.value=e})):(e(),d(ge,{key:0,onEnter:y[0]||=e=>f.value=!0}))]),_:1}),g(F,{style:{"z-index":`10000`},app:``,"model-value":r.value!=``,"onUpdate:modelValue":y[2]||=e=>r.value=``,timeout:4e3,color:o.value,location:`bottom left`,"close-on-content-click":``},{default:k(()=>[c(v(r.value),1)]),_:1},8,[`model-value`,`color`]),g(F,{app:``,"model-value":s.value!=``,"onUpdate:modelValue":y[3]||=e=>s.value=``,timeout:4e3,color:`red`},{default:k(()=>[u(`b`,null,v(s.value),1),u(`div`,{innerHTML:l.value},null,8,ve)]),_:1},8,[`model-value`])]),_:1})]),_:1}))}}));$.use(w),$.mount(`#app`);