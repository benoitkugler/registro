import{Ai as e,Gi as t,Hr as n,Jr as r,Li as i,Mi as a,Nt as o,R as s,Ri as c,Sa as ee,T as l,Tr as u,Wi as d,_i as te,ai as ne,b as re,d as f,di as ie,f as ae,fi as p,fr as m,ga as h,gi as oe,hr as se,ji as g,kt as ce,ma as _,qr as le,rt as v,sa as y,u as b,ur as ue,va as de,vr as x,wa as fe,xr as S}from"./VSnackbar-B_L40pBc.js";import{S as pe,_ as me,a as he,d as ge,g as _e,h as C,i as ve,m as ye,n as w,o as be,r as xe,s as T,v as E}from"./VSelect-DJ481VcW.js";import{n as D,r as Se,t as Ce}from"./filter-B4-agdr9.js";const O=u({alwaysFilter:Boolean,autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...D({filterKeys:[`title`]}),...w({hideNoData:!0,returnObject:!0}),...p(f({modelValue:null,role:`combobox`}),[`validationValue`,`dirty`])},`VCombobox`),k=S()({name:`VCombobox`,props:O(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(u,f){let{emit:p,slots:S}=f,{t:w}=ue(),D=_(),O=h(!1),k=h(!0),A=h(!1),j=_(),M=_(),N=h(-1),P=!1,{items:F,transformIn:we,transformOut:Te}=_e(u),{textColorClasses:Ee,textColorStyles:De}=ce(()=>D.value?.color),{InputIcon:Oe}=l(u),I=m(u,`modelValue`,[],e=>we(oe(e)),e=>{let t=Te(e);return u.multiple?t:t[0]??null}),L=re(u),R=de(()=>u.closableChips&&!L.isReadonly.value&&!L.isDisabled.value),z=g(()=>!!(u.chips||S.chip)),B=g(()=>z.value||!!S.selection),V=h(!u.multiple&&!B.value?I.value[0]?.title??``:``),H=h(null),U=g({get:()=>V.value,set:async e=>{if(V.value=e??``,e===null||e===``&&!u.multiple&&!B.value?I.value=[]:!u.multiple&&!B.value&&(I.value=[C(u,e)],t(()=>M.value?.scrollToIndex(0))),e&&u.multiple&&u.delimiters?.length){let t=We(e);t.length>1&&($(t),V.value=``)}e||(N.value=-1),k.value=!e}}),ke=g(()=>typeof u.counterValue==`function`?u.counterValue(I.value):typeof u.counterValue==`number`?u.counterValue:u.multiple?I.value.length:U.value.length),{filteredItems:W,getMatches:Ae}=Se(u,F,()=>H.value??(u.alwaysFilter||!k.value?U.value:``)),G=g(()=>u.hideSelected&&H.value===null?W.value.filter(e=>!I.value.some(t=>t.value===e.value)):W.value),K=g(()=>u.hideNoData&&!G.value.length||L.isReadonly.value||L.isDisabled.value),q=m(u,`menu`),J=g({get:()=>q.value,set:e=>{q.value&&!e&&j.value?.Î¨openChildren.size||e&&K.value||(q.value=e)}}),{menuId:je,ariaExpanded:Me,ariaControls:Ne}=xe(u,J);y(V,e=>{P?t(()=>P=!1):O.value&&!J.value&&(J.value=!0),p(`update:search`,e)}),y(I,e=>{!u.multiple&&!B.value&&(V.value=e[0]?.title??``)});let Pe=g(()=>I.value.map(e=>e.value)),Y=g(()=>G.value.find(e=>e.type===`item`&&!e.props.disabled)),X=g(()=>(u.autoSelectFirst===!0||u.autoSelectFirst===`exact`&&U.value===Y.value?.title)&&G.value.length>0&&!k.value&&!A.value),Z=_(),Fe=ve(Z,D);function Ie(e){P=!0,t(()=>P=!1),u.openOnClear&&(J.value=!0)}function Le(){K.value||(J.value=!0)}function Re(e){K.value||(O.value&&(e.preventDefault(),e.stopPropagation()),J.value=!J.value)}function ze(e){(n(e)||e.key===`Backspace`)&&D.value?.focus()}function Be(e){if(ne(e)||L.isReadonly.value)return;let t=D.value?.selectionStart,r=I.value.length;if([`Enter`,`ArrowDown`,`ArrowUp`].includes(e.key)&&e.preventDefault(),[`Enter`,`ArrowDown`].includes(e.key)&&(J.value=!0),[`Escape`].includes(e.key)&&(J.value=!1),X.value&&[`Enter`,`Tab`].includes(e.key)&&Y.value&&!I.value.some(e=>{let{value:t}=e;return t===Y.value.value})&&Q(Y.value),e.key===`ArrowDown`&&X.value&&Z.value?.focus(`next`),e.key===`Enter`&&U.value&&(Q(C(u,U.value),!0,!0),B.value&&(V.value=``)),[`Backspace`,`Delete`].includes(e.key)){if(!u.multiple&&B.value&&I.value.length>0&&!U.value)return Q(I.value[0],!1);if(~N.value){e.preventDefault();let t=N.value;Q(I.value[N.value],!1),N.value=t>=r-1?r-2:t}else e.key===`Backspace`&&!U.value&&(N.value=r-1);return}if(u.multiple)if(e.key===`ArrowLeft`){if(N.value<0&&t&&t>0)return;let e=N.value>-1?N.value-1:r-1;I.value[e]?N.value=e:(N.value=-1,D.value?.setSelectionRange(U.value.length,U.value.length))}else if(e.key===`ArrowRight`){if(N.value<0)return;let e=N.value+1;I.value[e]?N.value=e:(N.value=-1,D.value?.setSelectionRange(0,0))}else ~N.value&&n(e)&&(N.value=-1)}function Ve(e){let t=We(e?.clipboardData?.getData(`Text`)??``);t.length>1&&u.multiple&&(e.preventDefault(),$(t))}function He(){u.eager&&M.value?.calculateVisibleItems()}function Ue(){O.value&&D.value?.focus(),k.value=!0,H.value=null}function Q(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(!(!e||e.props.disabled))if(u.multiple){let t=I.value.findIndex(t=>(u.valueComparator||x)(t.value,e.value)),r=n??!~t;if(~t){let n=r?[...I.value,e]:[...I.value];n.splice(t,1),I.value=n}else r&&(I.value=[...I.value,e]);u.clearOnSelect&&(U.value=``)}else{let i=n!==!1;I.value=i?[e]:[],(!k.value||u.alwaysFilter)&&V.value&&(H.value=V.value),V.value=i&&!B.value?e.title:``,t(()=>{J.value=r,k.value=!0})}}function We(e){let t=[`
`,...u.delimiters??[]].map(r).join(`|`);return e.split(RegExp(`(?:${t})+`))}async function $(e){for(let n of e)n=n.trim(),n&&(Q(C(u,n)),await t())}function Ge(e){O.value=!0,setTimeout(()=>{A.value=!0})}function Ke(e){A.value=!1}return y(O,(e,t)=>{if(!(e||e===t)&&(N.value=-1,J.value=!1,U.value)){if(u.multiple){Q(C(u,U.value));return}if(!B.value)return;I.value.some(e=>{let{title:t}=e;return t===U.value})?V.value=``:Q(C(u,U.value))}}),y(J,e=>{if(!u.hideSelected&&e&&I.value.length&&k.value){let e=G.value.findIndex(e=>I.value.some(t=>(u.valueComparator||x)(t.value,e.value)));te&&window.requestAnimationFrame(()=>{e>=0&&M.value?.scrollToIndex(e)})}e&&(H.value=null)}),y(F,(e,t)=>{J.value||O.value&&!t.length&&e.length&&(J.value=!0)}),se(()=>{let t=!!(!u.hideNoData||G.value.length||S[`prepend-item`]||S[`append-item`]||S[`no-data`]),n=I.value.length>0,r=b.filterProps(u);return c(b,d({ref:D},r,{modelValue:U.value,"onUpdate:modelValue":e=>U.value=e,focused:O.value,"onUpdate:focused":e=>O.value=e,validationValue:I.externalValue,counterValue:ke.value,dirty:n,class:[`v-combobox`,{"v-combobox--active-menu":J.value,"v-combobox--chips":!!u.chips,"v-combobox--selection-slot":!!B.value,"v-combobox--selecting-index":N.value>-1,[`v-combobox--${u.multiple?`multiple`:`single`}`]:!0},u.class],style:u.style,readonly:L.isReadonly.value,placeholder:n?void 0:u.placeholder,"onClick:clear":Ie,"onMousedown:control":Le,onKeydown:Be,onPaste:Ve,"aria-expanded":Me.value,"aria-controls":Ne.value}),{...S,default:n=>{let{id:r}=n;return a(e,null,[c(be,d({id:je.value,ref:j,modelValue:J.value,"onUpdate:modelValue":e=>J.value=e,activator:`parent`,contentClass:`v-combobox__content`,disabled:K.value,eager:u.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,onAfterEnter:He,onAfterLeave:Ue},u.menuProps),{default:()=>[t&&c(ye,d({ref:Z,filterable:!0,selected:Pe.value,selectStrategy:u.multiple?`independent`:`single-independent`,onMousedown:e=>e.preventDefault(),selectable:!!G.value.length,onKeydown:ze,onFocusin:Ge,onFocusout:Ke,tabindex:`-1`,"aria-live":`polite`,"aria-labelledby":`${r.value}-label`,"aria-multiselectable":u.multiple,color:u.itemColor??u.color},Fe,u.listProps),{default:()=>[S[`prepend-item`]?.(),!G.value.length&&!u.hideNoData&&(S[`no-data`]?.()??c(E,{key:`no-data`,title:w(u.noDataText)},null)),c(he,{ref:M,renderless:!0,items:G.value,itemKey:`value`},{default:t=>{let{item:n,index:r,itemRef:i}=t,o=d(n.props,{ref:i,key:n.value,active:X.value&&n===Y.value?!0:void 0,onClick:()=>Q(n,null),"aria-posinset":r+1,"aria-setsize":G.value.length});return n.type===`divider`?S.divider?.({props:n.raw,index:r})??c(pe,d(n.props,{key:`divider-${r}`}),null):n.type===`subheader`?S.subheader?.({props:n.raw,index:r})??c(me,d(n.props,{key:`subheader-${r}`}),null):S.item?.({item:n,index:r,props:o})??c(E,d(o,{role:`option`}),{prepend:t=>{let{isSelected:r}=t;return a(e,null,[u.multiple&&!u.hideSelected?c(ge,{key:n.value,modelValue:r,ripple:!1,tabindex:`-1`,"aria-hidden":!0,onClick:e=>e.preventDefault()},null):void 0,n.props.prependAvatar&&c(s,{image:n.props.prependAvatar},null),n.props.prependIcon&&c(v,{icon:n.props.prependIcon},null)])},title:()=>k.value?n.title:Ce(`v-combobox`,n.title,Ae(n)?.title)})}}),S[`append-item`]?.()]})]}),I.value.map((e,t)=>{function n(t){t.stopPropagation(),t.preventDefault(),Q(e,!1)}let r=d(T.filterProps(e.props),{"onClick:close":n,onKeydown(e){e.key!==`Enter`&&e.key!==` `||(e.preventDefault(),e.stopPropagation(),n(e))},onMousedown(e){e.preventDefault(),e.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0}),s=z.value?!!S.chip:!!S.selection,l=s?le(z.value?S.chip({item:e,index:t,props:r}):S.selection({item:e,index:t})):void 0;if(!(s&&!l))return a(`div`,{key:e.value,class:ee([`v-combobox__selection`,t===N.value&&[`v-combobox__selection--selected`,Ee.value]]),style:fe(t===N.value?De.value:{})},[z.value?S.chip?c(o,{key:`chip-defaults`,defaults:{VChip:{closable:R.value,size:`small`,text:e.title}}},{default:()=>[l]}):c(T,d({key:`chip`,closable:R.value,size:`small`,text:e.title,disabled:e.props.disabled},r),null):l??a(`span`,{class:`v-combobox__selection-text`},[e.title,u.multiple&&t<I.value.length-1&&a(`span`,{class:`v-combobox__selection-comma`},[i(`,`)])])])})])},"append-inner":function(){var t=[...arguments];return a(e,null,[S[`append-inner`]?.(...t),(!u.hideNoData||u.items.length)&&u.menuIcon?c(v,{class:`v-combobox__menu-icon`,color:D.value?.fieldIconColor,icon:u.menuIcon,onMousedown:Re,onClick:ie,"aria-hidden":!0,tabindex:`-1`},null):void 0,u.appendInnerIcon&&c(Oe,{key:`append-icon`,name:`appendInner`,color:t[0].iconColor.value},null)])}})}),ae({isFocused:O,isPristine:k,menu:J,search:U,selectionIndex:N,filteredItems:W,select:Q},D)}});export{k as t};