import{Ca as e,Er as t,Gi as n,Jr as r,Ki as i,Mi as a,Ni as o,Nt as s,R as c,Ri as ee,Sr as l,T as u,Ta as te,Ur as d,Yr as ne,_a as f,_i as re,b as ie,ca as p,d as m,dr as ae,f as oe,fi as se,gr as ce,ha as h,ji as g,kt as le,oi as ue,pi as _,pr as v,rt as y,u as b,vi as de,ya as fe,yr as x,zi as S}from"./VSnackbar-CJGaOJRg.js";import{S as pe,_ as me,a as he,d as ge,g as _e,h as C,i as ve,m as ye,n as w,o as be,r as xe,s as T,v as E}from"./VSelect-Cz1h7iLA.js";import{n as D,r as Se,t as Ce}from"./filter-u9RSBvBk.js";const O=t({alwaysFilter:Boolean,autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...D({filterKeys:[`title`]}),...w({hideNoData:!0,returnObject:!0}),..._(m({modelValue:null,role:`combobox`}),[`validationValue`,`dirty`])},`VCombobox`),k=l()({name:`VCombobox`,props:O(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(t,l){let{emit:m,slots:_}=l,{t:w}=ae(),D=h(),O=f(!1),k=f(!0),A=f(!1),j=h(),M=h(),N=f(-1),P=!1,{items:F,transformIn:we,transformOut:Te}=_e(t),{textColorClasses:Ee,textColorStyles:De}=le(()=>D.value?.color),{InputIcon:Oe}=u(t),I=v(t,`modelValue`,[],e=>we(re(e)),e=>{let n=Te(e);return t.multiple?n:n[0]??null}),L=ie(t),R=fe(()=>t.closableChips&&!L.isReadonly.value&&!L.isDisabled.value),z=a(()=>!!(t.chips||_.chip)),B=a(()=>z.value||!!_.selection),V=f(!t.multiple&&!B.value?I.value[0]?.title??``:``),H=f(null),U=a({get:()=>V.value,set:async e=>{if(V.value=e??``,e===null||e===``&&!t.multiple&&!B.value?I.value=[]:!t.multiple&&!B.value&&(I.value=[C(t,e)],i(()=>M.value?.scrollToIndex(0))),e&&t.multiple&&t.delimiters?.length){let t=$(e);t.length>1&&(We(t),V.value=``)}e||(N.value=-1),k.value=!e}}),ke=a(()=>typeof t.counterValue==`function`?t.counterValue(I.value):typeof t.counterValue==`number`?t.counterValue:t.multiple?I.value.length:U.value.length),{filteredItems:W,getMatches:Ae}=Se(t,F,()=>H.value??(t.alwaysFilter||!k.value?U.value:``)),G=a(()=>t.hideSelected&&H.value===null?W.value.filter(e=>!I.value.some(t=>t.value===e.value)):W.value),K=a(()=>t.hideNoData&&!G.value.length||L.isReadonly.value||L.isDisabled.value),q=v(t,`menu`),J=a({get:()=>q.value,set:e=>{q.value&&!e&&j.value?.Î¨openChildren.size||e&&K.value||(q.value=e)}}),{menuId:je,ariaExpanded:Me,ariaControls:Ne}=xe(t,J);p(V,e=>{P?i(()=>P=!1):O.value&&!J.value&&(J.value=!0),m(`update:search`,e)}),p(I,e=>{!t.multiple&&!B.value&&(V.value=e[0]?.title??``)});let Pe=a(()=>I.value.map(e=>e.value)),Y=a(()=>G.value.find(e=>e.type===`item`&&!e.props.disabled)),X=a(()=>(t.autoSelectFirst===!0||t.autoSelectFirst===`exact`&&U.value===Y.value?.title)&&G.value.length>0&&!k.value&&!A.value),Z=h(),Fe=ve(Z,D);function Ie(e){P=!0,i(()=>P=!1),t.openOnClear&&(J.value=!0)}function Le(){K.value||(J.value=!0)}function Re(e){K.value||(O.value&&(e.preventDefault(),e.stopPropagation()),J.value=!J.value)}function ze(e){(d(e)||e.key===`Backspace`)&&D.value?.focus()}function Be(e){if(ue(e)||L.isReadonly.value)return;let n=D.value?.selectionStart,r=I.value.length;if([`Enter`,`ArrowDown`,`ArrowUp`].includes(e.key)&&e.preventDefault(),[`Enter`,`ArrowDown`].includes(e.key)&&(J.value=!0),[`Escape`].includes(e.key)&&(J.value=!1),X.value&&[`Enter`,`Tab`].includes(e.key)&&Y.value&&!I.value.some(e=>{let{value:t}=e;return t===Y.value.value})&&Q(Y.value),e.key===`ArrowDown`&&X.value&&Z.value?.focus(`next`),e.key===`Enter`&&U.value&&(Q(C(t,U.value),!0,!0),B.value&&(V.value=``)),[`Backspace`,`Delete`].includes(e.key)){if(!t.multiple&&B.value&&I.value.length>0&&!U.value)return Q(I.value[0],!1);if(~N.value){e.preventDefault();let t=N.value;Q(I.value[N.value],!1),N.value=t>=r-1?r-2:t}else e.key===`Backspace`&&!U.value&&(N.value=r-1);return}if(t.multiple)if(e.key===`ArrowLeft`){if(N.value<0&&n&&n>0)return;let e=N.value>-1?N.value-1:r-1;I.value[e]?N.value=e:(N.value=-1,D.value?.setSelectionRange(U.value.length,U.value.length))}else if(e.key===`ArrowRight`){if(N.value<0)return;let e=N.value+1;I.value[e]?N.value=e:(N.value=-1,D.value?.setSelectionRange(0,0))}else ~N.value&&d(e)&&(N.value=-1)}function Ve(e){let n=$(e?.clipboardData?.getData(`Text`)??``);n.length>1&&t.multiple&&(e.preventDefault(),We(n))}function He(){t.eager&&M.value?.calculateVisibleItems()}function Ue(){O.value&&D.value?.focus(),k.value=!0,H.value=null}function Q(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(!(!e||e.props.disabled))if(t.multiple){let r=I.value.findIndex(n=>(t.valueComparator||x)(n.value,e.value)),i=n??!~r;if(~r){let t=i?[...I.value,e]:[...I.value];t.splice(r,1),I.value=t}else i&&(I.value=[...I.value,e]);t.clearOnSelect&&(U.value=``)}else{let a=n!==!1;I.value=a?[e]:[],(!k.value||t.alwaysFilter)&&V.value&&(H.value=V.value),V.value=a&&!B.value?e.title:``,i(()=>{J.value=r,k.value=!0})}}function $(e){let n=[`
`,...t.delimiters??[]].map(ne).join(`|`);return e.split(RegExp(`(?:${n})+`))}async function We(e){for(let n of e)n=n.trim(),n&&(Q(C(t,n)),await i())}function Ge(e){O.value=!0,setTimeout(()=>{A.value=!0})}function Ke(e){A.value=!1}return p(O,(e,n)=>{if(!(e||e===n)&&(N.value=-1,J.value=!1,U.value)){if(t.multiple){Q(C(t,U.value));return}if(!B.value)return;I.value.some(e=>{let{title:t}=e;return t===U.value})?V.value=``:Q(C(t,U.value))}}),p(J,e=>{if(!t.hideSelected&&e&&I.value.length&&k.value){let e=G.value.findIndex(e=>I.value.some(n=>(t.valueComparator||x)(n.value,e.value)));de&&window.requestAnimationFrame(()=>{e>=0&&M.value?.scrollToIndex(e)})}e&&(H.value=null)}),p(F,(e,t)=>{J.value||O.value&&!t.length&&e.length&&(J.value=!0)}),ce(()=>{let i=!!(!t.hideNoData||G.value.length||_[`prepend-item`]||_[`append-item`]||_[`no-data`]),a=I.value.length>0,l=b.filterProps(t);return S(b,n({ref:D},l,{modelValue:U.value,"onUpdate:modelValue":e=>U.value=e,focused:O.value,"onUpdate:focused":e=>O.value=e,validationValue:I.externalValue,counterValue:ke.value,dirty:a,class:[`v-combobox`,{"v-combobox--active-menu":J.value,"v-combobox--chips":!!t.chips,"v-combobox--selection-slot":!!B.value,"v-combobox--selecting-index":N.value>-1,[`v-combobox--${t.multiple?`multiple`:`single`}`]:!0},t.class],style:t.style,readonly:L.isReadonly.value,placeholder:a?void 0:t.placeholder,"onClick:clear":Ie,"onMousedown:control":Le,onKeydown:Be,onPaste:Ve,"aria-expanded":Me.value,"aria-controls":Ne.value}),{..._,default:a=>{let{id:l}=a;return o(g,null,[S(be,n({id:je.value,ref:j,modelValue:J.value,"onUpdate:modelValue":e=>J.value=e,activator:`parent`,contentClass:`v-combobox__content`,disabled:K.value,eager:t.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,onAfterEnter:He,onAfterLeave:Ue},t.menuProps),{default:()=>[i&&S(ye,n({ref:Z,filterable:!0,selected:Pe.value,selectStrategy:t.multiple?`independent`:`single-independent`,onMousedown:e=>e.preventDefault(),selectable:!!G.value.length,onKeydown:ze,onFocusin:Ge,onFocusout:Ke,tabindex:`-1`,"aria-live":`polite`,"aria-labelledby":`${l.value}-label`,"aria-multiselectable":t.multiple,color:t.itemColor??t.color},Fe,t.listProps),{default:()=>[_[`prepend-item`]?.(),!G.value.length&&!t.hideNoData&&(_[`no-data`]?.()??S(E,{key:`no-data`,title:w(t.noDataText)},null)),S(he,{ref:M,renderless:!0,items:G.value,itemKey:`value`},{default:e=>{let{item:r,index:i,itemRef:a}=e,s=n(r.props,{ref:a,key:r.value,active:X.value&&r===Y.value?!0:void 0,onClick:()=>Q(r,null),"aria-posinset":i+1,"aria-setsize":G.value.length});return r.type===`divider`?_.divider?.({props:r.raw,index:i})??S(pe,n(r.props,{key:`divider-${i}`}),null):r.type===`subheader`?_.subheader?.({props:r.raw,index:i})??S(me,n(r.props,{key:`subheader-${i}`}),null):_.item?.({item:r,index:i,props:s})??S(E,n(s,{role:`option`}),{prepend:e=>{let{isSelected:n}=e;return o(g,null,[t.multiple&&!t.hideSelected?S(ge,{key:r.value,modelValue:n,ripple:!1,tabindex:`-1`,"aria-hidden":!0,onClick:e=>e.preventDefault()},null):void 0,r.props.prependAvatar&&S(c,{image:r.props.prependAvatar},null),r.props.prependIcon&&S(y,{icon:r.props.prependIcon},null)])},title:()=>k.value?r.title:Ce(`v-combobox`,r.title,Ae(r)?.title)})}}),_[`append-item`]?.()]})]}),I.value.map((i,a)=>{function c(e){e.stopPropagation(),e.preventDefault(),Q(i,!1)}let l=n(T.filterProps(i.props),{"onClick:close":c,onKeydown(e){e.key!==`Enter`&&e.key!==` `||(e.preventDefault(),e.stopPropagation(),c(e))},onMousedown(e){e.preventDefault(),e.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0}),u=z.value?!!_.chip:!!_.selection,d=u?r(z.value?_.chip({item:i,index:a,props:l}):_.selection({item:i,index:a})):void 0;if(!(u&&!d))return o(`div`,{key:i.value,class:e([`v-combobox__selection`,a===N.value&&[`v-combobox__selection--selected`,Ee.value]]),style:te(a===N.value?De.value:{})},[z.value?_.chip?S(s,{key:`chip-defaults`,defaults:{VChip:{closable:R.value,size:`small`,text:i.title}}},{default:()=>[d]}):S(T,n({key:`chip`,closable:R.value,size:`small`,text:i.title,disabled:i.props.disabled},l),null):d??o(`span`,{class:`v-combobox__selection-text`},[i.title,t.multiple&&a<I.value.length-1&&o(`span`,{class:`v-combobox__selection-comma`},[ee(`,`)])])])})])},"append-inner":function(){var e=[...arguments];return o(g,null,[_[`append-inner`]?.(...e),(!t.hideNoData||t.items.length)&&t.menuIcon?S(y,{class:`v-combobox__menu-icon`,color:D.value?.fieldIconColor,icon:t.menuIcon,onMousedown:Re,onClick:se,"aria-hidden":!0,tabindex:`-1`},null):void 0,t.appendInnerIcon&&S(Oe,{key:`append-icon`,name:`appendInner`,color:e[0].iconColor.value},null)])}})}),oe({isFocused:O,isPristine:k,menu:J,search:U,selectionIndex:N,filteredItems:W,select:Q},D)}});export{k as t};