var Z=Object.defineProperty;var ee=(d,e,t)=>e in d?Z(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t;var N=(d,e,t)=>ee(d,typeof e!="symbol"?e+"":e,t);import{c as te,a as ae,f as se,d as x,r as y,b,s as f,F as C,e as a,w as n,g as $,h as z,i as w,V as ne,j as _,k as S,l as re,m as ie,n as F,o as oe,t as T,p as le,q,bE as V,bF as ue,bG as ce,a3 as D,u as H,v as M,x as X,y as R,z as de,A as pe,B as me,M as E,aV as fe,aY as W,aj as ve,aW as B,ae as Y,H as k,aX as he,ad as ye,ac as ge,a0 as _e,ai as Ve,bh as be,aU as we,bz as Ie,bA as ke,bB as j,bC as xe,bD as Pe}from"./VSnackbar-CgAukBO4.js";import{V as Ce,a as Ue,u as A,f as $e,h as Te,_ as Se,g as Re,e as Ee,n as qe,o as K,p as Q,m as Be,q as De,r as He}from"./VTabs-Cvy_O6R9.js";import{V as Me}from"./VTooltip-DXEu9Zu0.js";import"./VWindowItem-6JFtH0Uu.js";const Ae=te({locale:{locale:"fr",messages:{fr:se}},theme:{defaultTheme:"light",themes:{light:{colors:ae}}}}),J=x({__name:"NavBar",props:{title:{},hideMenu:{type:Boolean}},setup(d){const e=d,t="/static/repere/logo.png",s="v0.1.1",o=y(!1);return(p,r)=>(f(),b(C,null,[a(Ce,{app:"",modelValue:o.value,"onUpdate:modelValue":r[0]||(r[0]=u=>o.value=u),temporary:""},{default:n(()=>[a($,{title:"Registro - Portail des directeurs",subtitle:s}),a(z),a($,{"prepend-icon":"mdi-calendar-multiple-check",link:"",to:{path:"/inscriptions"},color:"primary"},{default:n(()=>r[2]||(r[2]=[w(" Inscriptions ")])),_:1}),a(z),a($,{"prepend-icon":"mdi-logout",link:"",to:{path:"/"},color:"primary"},{default:n(()=>r[3]||(r[3]=[w(" Se déconnecter ")])),_:1})]),_:1},8,["modelValue"]),a(ne,{rounded:"",elevation:"4",color:"secondary"},{append:n(()=>[le(p.$slots,"default"),r[4]||(r[4]=q("div",{class:"mr-2"},null,-1))]),default:n(()=>[e.hideMenu?S("",!0):(f(),_(Ue,{key:0,onClick:r[1]||(r[1]=u=>o.value=!o.value)})),a(re,null,{default:n(()=>[a(ie,null,{default:n(()=>[a(F,{"align-self":"center",cols:"auto"},{default:n(()=>[a(oe,{width:"60",src:t})]),_:1}),a(F,{"align-self":"center"},{default:n(()=>[w(T(e.title),1)]),_:1})]),_:1})]),_:1})]),_:3})],64))}});class Le{constructor(e,t){this.baseUrl=e,this.authToken=t}getHeaders(){return{Authorization:"Bearer "+this.authToken}}async Loggin(e){const t=this.baseUrl+"/api/v1/directeurs/loggin";this.startRequest();try{return(await V.get(t,{headers:this.getHeaders(),params:{password:e.password,idCamp:String(e.idCamp)}})).data}catch(s){this.handleError(s)}}async GetCamps(){const e=this.baseUrl+"/api/v1/directeurs/shared/camps";this.startRequest();try{return(await V.post(e,null,{headers:this.getHeaders()})).data}catch(t){this.handleError(t)}}async SelectPersonne(e){const t=this.baseUrl+"/api/v1/directeurs/shared/personne";this.startRequest();try{return(await V.get(t,{headers:this.getHeaders(),params:{search:e.search}})).data}catch(s){this.handleError(s)}}async InscriptionsGet(){const e=this.baseUrl+"/api/v1/directeurs/inscriptions";this.startRequest();try{return(await V.get(e,{headers:this.getHeaders()})).data}catch(t){this.handleError(t)}}async InscriptionsSearchSimilaires(e){const t=this.baseUrl+"/api/v1/directeurs/inscriptions/search-similaires";this.startRequest();try{return(await V.get(t,{headers:this.getHeaders(),params:{idPersonne:String(e.idPersonne)}})).data}catch(s){this.handleError(s)}}async InscriptionsIdentifiePersonne(e){const t=this.baseUrl+"/api/v1/directeurs/inscriptions/identifie";this.startRequest();try{return(await V.post(t,e,{headers:this.getHeaders()})).data}catch(s){this.handleError(s)}}async InscriptionsValide(e){const t=this.baseUrl+"/api/v1/directeurs/inscriptions/valide";this.startRequest();try{return(await V.post(t,null,{headers:this.getHeaders(),params:{idDossier:String(e.idDossier)}})).data}catch(s){this.handleError(s)}}async ParticipantsGet(){const e=this.baseUrl+"/api/v1/directeurs/participants";this.startRequest();try{return(await V.get(e,{headers:this.getHeaders()})).data}catch(t){this.handleError(t)}}async ParticipantsUpdate(e){const t=this.baseUrl+"/api/v1/directeurs/participants";this.startRequest();try{return await V.post(t,e,{headers:this.getHeaders()}),!0}catch(s){this.handleError(s)}}}class Ge extends Le{constructor(t,s,o,p){super(o,p);N(this,"camp",null);this.onError=t,this.showMessage=s}hasToken(){return this.authToken!=""}setCamp(t,s){this.camp=t,this.authToken=s}handleError(t){const{kind:s,messageHtml:o}=ce(t);this.onError(s,o)}startRequest(){}}const m=new Ge((d,e)=>{},(d,e)=>{},ue(),""),Ne=x({__name:"index",setup(d){const e=A();D(s);const t=y([]);async function s(){const v=await m.GetCamps();v!==void 0&&(t.value=v||[])}const o=y(0),p=y(!1),r=y(""),u=y([]);async function h(){const v=t.value.find(c=>c.Id==o.value);if(!v)return;const l=await m.Loggin({password:r.value,idCamp:o.value});l!==void 0&&(l.IsValid?(m.setCamp(v,l.Token),m.showMessage("Bienvenue !"),e.push({path:"/inscriptions"})):u.value=["Mot de passe incorrect."])}return(v,l)=>{const c=$e;return f(),b(C,null,[a(J,{title:"Connection à la page Directeur","hide-menu":""}),a(me,{class:"fill-height"},{default:n(()=>[a(H,{title:"Connection",class:"mx-auto",width:"400px"},{default:n(()=>[a(M,null,{default:n(()=>[a(c,{label:"Camp",modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=i=>o.value=i),camps:t.value,name:"user","default-style":""},null,8,["modelValue","camps"]),a(X,{label:"Mot de passe",modelValue:r.value,"onUpdate:modelValue":[l[2]||(l[2]=i=>r.value=i),l[3]||(l[3]=i=>u.value=[])],"error-messages":u.value,type:p.value?void 0:"password",name:"password"},{"append-inner":n(()=>[a(R,{class:"ml-2",size:"small",icon:p.value?"mdi-eye":"mdi-eye-off",flat:"",onClick:l[1]||(l[1]=i=>p.value=!p.value)},null,8,["icon"])]),_:1},8,["modelValue","error-messages","type"])]),_:1}),a(de,null,{default:n(()=>[a(pe),a(R,{disabled:!o.value||!r.value.length,onClick:h},{default:n(()=>l[4]||(l[4]=[w("Se connecter")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})],64)}}}),ze={key:1,class:"text-center font-italic"},Fe={key:2},We=x({__name:"PannelInscriptions",emits:["goTo"],setup(d,{emit:e}){const t=e,s=y(!1);D(p);const o=y([]);async function p(){s.value=!0;const l=await m.InscriptionsGet();s.value=!1,l!==void 0&&(o.value=l||[])}const r=y(""),u=E(()=>{const l=fe(r.value);return o.value.filter(c=>{var i;return W.match(c.Responsable,l)||((i=c.Participants)==null?void 0:i.some(g=>W.match(g.Personne,l)||ve.match(g.Camp,l)))})});async function h(l,c){const i=await m.InscriptionsIdentifiePersonne({IdDossier:l,Target:c});if(i===void 0)return;m.showMessage("Profil identifié avec succès.");const g=o.value.findIndex(I=>I.Dossier.Id==l);o.value[g]=i}async function v(l){const c=l.Dossier.Id,i=await m.InscriptionsValide({idDossier:c});if(i!==void 0)if(m.showMessage("Inscription validée avec succès.","",{title:"Aller aux participants",action:()=>t("goTo")}),i.Dossier.IsValidated)o.value=o.value.filter(g=>g.Dossier.Id!=c);else{const g=o.value.findIndex(I=>I.Dossier.Id==c);o.value[g]=i}}return(l,c)=>(f(),_(H,{title:"Inscriptions",subtitle:"En attente de validation",class:"ma-2"},{append:n(()=>[a(X,{width:"300","append-inner-icon":"mdi-magnify",label:"Rechercher","hide-details":"",modelValue:r.value,"onUpdate:modelValue":c[0]||(c[0]=i=>r.value=i)},null,8,["modelValue"])]),default:n(()=>[a(M,null,{default:n(()=>[s.value?(f(),_(B,{key:0})):o.value.length?(f(),b("div",Fe,[(f(!0),b(C,null,Y(u.value,(i,g)=>{var I;return f(),_(Te,{class:"my-1",key:g,inscription:i,"hide-delete":"","already-validated":(I=i.ValidatedBy)==null?void 0:I.includes(k(m).camp.Id),onIdentifie:U=>h(i.Dossier.Id,U),onValide:U=>v(i),api:{searchSimilaires:k(m).InscriptionsSearchSimilaires.bind(k(m)),selectPersonne:k(m).SelectPersonne.bind(k(m))}},null,8,["inscription","already-validated","onIdentifie","onValide","api"])}),128))])):(f(),b("div",ze," Il n'y a aucune inscription à valider. "))]),_:1})]),_:1}))}}),je={key:1},Ke={key:0,class:"text-center font-italic"},Qe=x({__name:"PannelParticipants",setup(d,{expose:e}){D(()=>{h(),o()}),e({loadParticipants:h});const t=y(!1),s=y([]);async function o(){const c=await m.GetCamps();c!==void 0&&(s.value=c||[])}const p=y(!1),r=E(()=>{const c=(u.value||[]).map(i=>i);return c.sort((i,g)=>he.cmp(i,g,p.value)),c}),u=y(null);async function h(){t.value=!0;const c=await m.ParticipantsGet();t.value=!1,c!==void 0&&(u.value=c)}const v=y(null);async function l(c){if(v.value==null||u.value==null)return;const i=await m.ParticipantsUpdate(c);v.value=null,i!==void 0&&(m.showMessage("Participant modifié avec succès."),h())}return(c,i)=>{const g=Se,I=Re,U=Ee;return u.value!=null?(f(),_(H,{key:0,title:"Participants"},{append:n(()=>[a(Me,{text:"Trier par moment d'inscription"},{activator:n(({props:P})=>[a(R,_e(P,{icon:"",variant:p.value?"tonal":"flat",onClick:i[0]||(i[0]=G=>p.value=!p.value)}),{default:n(()=>[a(Ve,null,{default:n(()=>i[2]||(i[2]=[w("mdi-sort-calendar-ascending")])),_:1})]),_:2},1040,["variant"])]),_:1})]),default:n(()=>[a(M,{class:"mt-4"},{default:n(()=>[t.value?(f(),_(B,{key:0,type:"table"})):(f(),b("div",je,[a(g),r.value.length?S("",!0):(f(),b("div",Ke," Aucun participant n'est encore inscrit sur ce séjour. ")),(f(!0),b(C,null,Y(r.value,(P,G)=>(f(),_(I,{participant:P,index:G},{actions:n(()=>[a(ye,{density:"comfortable"},{default:n(()=>[a($,{title:"Modifier","prepend-icon":"mdi-pencil",onClick:at=>v.value=P},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["participant","index"]))),256))]))]),_:1}),v.value!=null?(f(),_(ge,{key:0,"model-value":v.value!=null,"onUpdate:modelValue":i[1]||(i[1]=P=>v.value=null),"max-width":"800px"},{default:n(()=>[a(U,{participant:v.value.Participant,personne:v.value.Personne,"hide-personne-dossier":"",onSave:l},null,8,["participant","personne"])]),_:1},8,["model-value"])):S("",!0)]),_:1})):(f(),_(B,{key:1,type:"card"}))}}}),Xe=x({__name:"inscriptions",setup(d){const e=A(),t=E(()=>Oe(e.currentRoute.value.query)),s=E(()=>t.value.tab||"insc"),o=be("participants");function p(r){var h;const u=e.currentRoute.value;e.push({path:u.path,query:{tab:r}}),r=="participants"&&((h=o.value)==null||h.loadParticipants())}return(r,u)=>{var h;return f(),b(C,null,[a(J,{title:`${(h=k(m).camp)==null?void 0:h.Label} - Suivi des inscriptions`},{default:n(()=>[a(qe,{"model-value":s.value,"onUpdate:modelValue":u[0]||(u[0]=v=>p(v))},{default:n(()=>[a(K,{value:"insc"},{default:n(()=>u[2]||(u[2]=[w("Nouvelles inscriptions")])),_:1}),a(K,{value:"participants"},{default:n(()=>u[3]||(u[3]=[w("Liste des participants")])),_:1})]),_:1},8,["model-value"])]),_:1},8,["title"]),a(Be,{"model-value":s.value},{default:n(()=>[a(Q,{value:"insc"},{default:n(()=>[a(We,{onGoTo:u[1]||(u[1]=()=>p("participants"))})]),_:1}),a(Q,{value:"participants"},{default:n(()=>[a(Qe,{ref_key:"participants",ref:o},null,512)]),_:1})]),_:1},8,["model-value"])],64)}}}),Ye=[{path:"/",component:Ne},{path:"/inscriptions",component:Xe}],Je="/directeurs",L=De({history:He(Je),routes:Ye});L.onError((d,e)=>{var t,s;(s=(t=d==null?void 0:d.message)==null?void 0:t.includes)!=null&&s.call(t,"Failed to fetch dynamically imported module")?localStorage.getItem("vuetify:dynamic-reload")?console.error("Dynamic import error, reloading page did not fix it",d):(console.log("Reloading page to fix dynamic import error"),localStorage.setItem("vuetify:dynamic-reload","true"),location.assign(e.fullPath)):console.error(d)});L.isReady().then(()=>{localStorage.removeItem("vuetify:dynamic-reload")});function Oe(d){return{tab:d.tab}}function Ze(d){d.use(Ae).use(L)}const et=["innerHTML"],tt=x({__name:"App",setup(d){const e=we({text:"",color:"secondary",action:void 0,timeout:4e3}),t=y(""),s=y("");return m.onError=(p,r)=>{t.value=p,s.value=r},m.showMessage=(p,r,u)=>{e.text=p,e.color=r||"success",e.action=u,e.timeout=1e4,e.timeout=4e3},A().beforeEach(async(p,r)=>{if(!m.hasToken()&&p.path!=="/")return{path:"/"}}),(p,r)=>{const u=Ie("router-view");return f(),_(xe,null,{default:n(()=>[a(ke,null,{default:n(()=>[a(u),a(j,{style:{"z-index":"10000"},app:"","model-value":e.text!="","onUpdate:modelValue":r[1]||(r[1]=h=>e.text=""),timeout:e.timeout,color:e.color,location:"bottom left","close-on-content-click":""},{default:n(()=>[w(T(e.text)+" ",1),e.action?(f(),_(R,{key:0,onClick:r[0]||(r[0]=h=>e.action.action()),class:"ml-2"},{default:n(()=>[w(T(e.action.title),1)]),_:1})):S("",!0)]),_:1},8,["model-value","timeout","color"]),a(j,{app:"","model-value":t.value!="","onUpdate:modelValue":r[2]||(r[2]=h=>t.value=""),timeout:4e3,color:"red"},{default:n(()=>[q("b",null,T(t.value),1),q("div",{innerHTML:s.value},null,8,et)]),_:1},8,["model-value"])]),_:1})]),_:1})}}}),O=Pe(tt);Ze(O);O.mount("#app");
