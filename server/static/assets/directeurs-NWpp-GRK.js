var Z=Object.defineProperty;var ee=(p,e,t)=>e in p?Z(p,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[e]=t;var G=(p,e,t)=>ee(p,typeof e!="symbol"?e+"":e,t);import{c as te,a as ae,f as se,d as x,r as h,b,s as f,F as C,e as a,w as n,g as $,h as N,i as w,V as ne,j as _,k as T,l as re,m as ie,n as z,o as oe,t as S,p as le,q,bE as V,bF as ue,bG as ce,a3 as D,u as H,v as M,x as Q,y as R,z as de,A as pe,B as me,M as E,aV as fe,aY as F,aj as ve,aW as B,ae as X,H as k,aX as he,ad as ye,ac as ge,a0 as _e,ai as Ve,bh as be,aU as we,bz as Ie,bA as ke,bB as W,bC as xe,bD as Pe}from"./VSnackbar-CgAukBO4.js";import{V as Ce,a as Ue,u as Y,f as $e,h as Se,_ as Te,g as Re,e as Ee,n as qe,o as j,p as K,m as Be,q as De,r as He}from"./VTabs-BagcHLsx.js";import{V as Me}from"./VTooltip-DXEu9Zu0.js";import"./VWindowItem-6JFtH0Uu.js";const Ae=te({locale:{locale:"fr",messages:{fr:se}},theme:{defaultTheme:"light",themes:{light:{colors:ae}}}}),J=x({__name:"NavBar",props:{title:{},hideMenu:{type:Boolean}},setup(p){const e=p,t="/static/repere/logo.png",s="v0.1.0",i=h(!1);return(l,o)=>(f(),b(C,null,[a(Ce,{app:"",modelValue:i.value,"onUpdate:modelValue":o[0]||(o[0]=c=>i.value=c),temporary:""},{default:n(()=>[a($,{title:"Registro - Portail des directeurs",subtitle:s}),a(N),a($,{"prepend-icon":"mdi-calendar-multiple-check",link:"",to:{path:"/inscriptions"},color:"primary"},{default:n(()=>o[2]||(o[2]=[w(" Inscriptions ")])),_:1}),a(N),a($,{"prepend-icon":"mdi-logout",link:"",to:{path:"/"},color:"primary"},{default:n(()=>o[3]||(o[3]=[w(" Se déconnecter ")])),_:1})]),_:1},8,["modelValue"]),a(ne,{rounded:"",elevation:"4",color:"secondary"},{append:n(()=>[le(l.$slots,"default"),o[4]||(o[4]=q("div",{class:"mr-2"},null,-1))]),default:n(()=>[e.hideMenu?T("",!0):(f(),_(Ue,{key:0,onClick:o[1]||(o[1]=c=>i.value=!i.value)})),a(re,null,{default:n(()=>[a(ie,null,{default:n(()=>[a(z,{"align-self":"center",cols:"auto"},{default:n(()=>[a(oe,{width:"60",src:t})]),_:1}),a(z,{"align-self":"center"},{default:n(()=>[w(S(e.title),1)]),_:1})]),_:1})]),_:1})]),_:3})],64))}});class Le{constructor(e,t){this.baseUrl=e,this.authToken=t}getHeaders(){return{Authorization:"Bearer "+this.authToken}}async Loggin(e){const t=this.baseUrl+"/api/v1/directeurs/loggin";this.startRequest();try{return(await V.get(t,{headers:this.getHeaders(),params:{password:e.password,idCamp:String(e.idCamp)}})).data}catch(s){this.handleError(s)}}async GetCamps(){const e=this.baseUrl+"/api/v1/directeurs/shared/camps";this.startRequest();try{return(await V.post(e,null,{headers:this.getHeaders()})).data}catch(t){this.handleError(t)}}async SelectPersonne(e){const t=this.baseUrl+"/api/v1/directeurs/shared/personne";this.startRequest();try{return(await V.get(t,{headers:this.getHeaders(),params:{search:e.search}})).data}catch(s){this.handleError(s)}}async InscriptionsGet(){const e=this.baseUrl+"/api/v1/directeurs/inscriptions";this.startRequest();try{return(await V.get(e,{headers:this.getHeaders()})).data}catch(t){this.handleError(t)}}async InscriptionsSearchSimilaires(e){const t=this.baseUrl+"/api/v1/directeurs/inscriptions/search-similaires";this.startRequest();try{return(await V.get(t,{headers:this.getHeaders(),params:{idPersonne:String(e.idPersonne)}})).data}catch(s){this.handleError(s)}}async InscriptionsIdentifiePersonne(e){const t=this.baseUrl+"/api/v1/directeurs/inscriptions/identifie";this.startRequest();try{return(await V.post(t,e,{headers:this.getHeaders()})).data}catch(s){this.handleError(s)}}async InscriptionsValide(e){const t=this.baseUrl+"/api/v1/directeurs/inscriptions/valide";this.startRequest();try{return(await V.post(t,null,{headers:this.getHeaders(),params:{idDossier:String(e.idDossier)}})).data}catch(s){this.handleError(s)}}async ParticipantsGet(){const e=this.baseUrl+"/api/v1/directeurs/participants";this.startRequest();try{return(await V.get(e,{headers:this.getHeaders()})).data}catch(t){this.handleError(t)}}async ParticipantsUpdate(e){const t=this.baseUrl+"/api/v1/directeurs/participants";this.startRequest();try{return await V.post(t,e,{headers:this.getHeaders()}),!0}catch(s){this.handleError(s)}}}class Ge extends Le{constructor(t,s,i,l){super(i,l);G(this,"camp",null);this.onError=t,this.showMessage=s}setCamp(t,s){this.camp=t,this.authToken=s}handleError(t){const{kind:s,messageHtml:i}=ce(t);this.onError(s,i)}startRequest(){}}const m=new Ge((p,e)=>{},(p,e)=>{},ue(),""),Ne=x({__name:"index",setup(p){const e=Y();D(s);const t=h([]);async function s(){const v=await m.GetCamps();v!==void 0&&(t.value=v||[])}const i=h(0),l=h(!1),o=h(""),c=h([]);async function g(){const v=t.value.find(d=>d.Id==i.value);if(!v)return;const u=await m.Loggin({password:o.value,idCamp:i.value});u!==void 0&&(u.IsValid?(m.setCamp(v,u.Token),m.showMessage("Bienvenue !"),e.push({path:"/inscriptions"})):c.value=["Mot de passe incorrect."])}return(v,u)=>{const d=$e;return f(),b(C,null,[a(J,{title:"Connection à la page Directeur","hide-menu":""}),a(me,{class:"fill-height"},{default:n(()=>[a(H,{title:"Connection",class:"mx-auto",width:"400px"},{default:n(()=>[a(M,null,{default:n(()=>[a(d,{label:"Camp",modelValue:i.value,"onUpdate:modelValue":u[0]||(u[0]=r=>i.value=r),camps:t.value,name:"user","default-style":""},null,8,["modelValue","camps"]),a(Q,{label:"Mot de passe",modelValue:o.value,"onUpdate:modelValue":[u[2]||(u[2]=r=>o.value=r),u[3]||(u[3]=r=>c.value=[])],"error-messages":c.value,type:l.value?void 0:"password",name:"password"},{"append-inner":n(()=>[a(R,{class:"ml-2",size:"small",icon:l.value?"mdi-eye":"mdi-eye-off",flat:"",onClick:u[1]||(u[1]=r=>l.value=!l.value)},null,8,["icon"])]),_:1},8,["modelValue","error-messages","type"])]),_:1}),a(de,null,{default:n(()=>[a(pe),a(R,{disabled:!i.value||!o.value.length,onClick:g},{default:n(()=>u[4]||(u[4]=[w("Se connecter")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})],64)}}}),ze={key:1,class:"text-center font-italic"},Fe={key:2},We=x({__name:"PannelInscriptions",emits:["goTo"],setup(p,{emit:e}){const t=e,s=h(!1);D(l);const i=h([]);async function l(){s.value=!0;const u=await m.InscriptionsGet();s.value=!1,u!==void 0&&(i.value=u||[])}const o=h(""),c=E(()=>{const u=fe(o.value);return i.value.filter(d=>{var r;return F.match(d.Responsable,u)||((r=d.Participants)==null?void 0:r.some(y=>F.match(y.Personne,u)||ve.match(y.Camp,u)))})});async function g(u,d){const r=await m.InscriptionsIdentifiePersonne({IdDossier:u,Target:d});if(r===void 0)return;m.showMessage("Profil identifié avec succès.");const y=i.value.findIndex(I=>I.Dossier.Id==u);i.value[y]=r}async function v(u){const d=u.Dossier.Id,r=await m.InscriptionsValide({idDossier:d});if(r!==void 0)if(m.showMessage("Inscription validée avec succès.","",{title:"Aller aux participants",action:()=>t("goTo")}),r.Dossier.IsValidated)i.value=i.value.filter(y=>y.Dossier.Id!=d);else{const y=i.value.findIndex(I=>I.Dossier.Id==d);i.value[y]=r}}return(u,d)=>(f(),_(H,{title:"Inscriptions",subtitle:"En attente de validation",class:"ma-2"},{append:n(()=>[a(Q,{width:"300","append-inner-icon":"mdi-magnify",label:"Rechercher","hide-details":"",modelValue:o.value,"onUpdate:modelValue":d[0]||(d[0]=r=>o.value=r)},null,8,["modelValue"])]),default:n(()=>[a(M,null,{default:n(()=>[s.value?(f(),_(B,{key:0})):i.value.length?(f(),b("div",Fe,[(f(!0),b(C,null,X(c.value,(r,y)=>{var I;return f(),_(Se,{class:"my-1",key:y,inscription:r,"hide-delete":"","already-validated":(I=r.ValidatedBy)==null?void 0:I.includes(k(m).camp.Id),onIdentifie:U=>g(r.Dossier.Id,U),onValide:U=>v(r),api:{searchSimilaires:k(m).InscriptionsSearchSimilaires.bind(k(m)),selectPersonne:k(m).SelectPersonne.bind(k(m))}},null,8,["inscription","already-validated","onIdentifie","onValide","api"])}),128))])):(f(),b("div",ze," Il n'y a aucune inscription à valider. "))]),_:1})]),_:1}))}}),je={key:1},Ke={key:0,class:"text-center font-italic"},Qe=x({__name:"PannelParticipants",setup(p,{expose:e}){D(()=>{g(),i()}),e({loadParticipants:g});const t=h(!1),s=h([]);async function i(){const d=await m.GetCamps();d!==void 0&&(s.value=d||[])}const l=h(!1),o=E(()=>{const d=(c.value||[]).map(r=>r);return d.sort((r,y)=>he.cmp(r,y,l.value)),d}),c=h(null);async function g(){t.value=!0;const d=await m.ParticipantsGet();t.value=!1,d!==void 0&&(c.value=d)}const v=h(null);async function u(d){if(v.value==null||c.value==null)return;const r=await m.ParticipantsUpdate(d);v.value=null,r!==void 0&&(m.showMessage("Participant modifié avec succès."),g())}return(d,r)=>{const y=Te,I=Re,U=Ee;return c.value!=null?(f(),_(H,{key:0,title:"Participants"},{append:n(()=>[a(Me,{text:"Trier par moment d'inscription"},{activator:n(({props:P})=>[a(R,_e(P,{icon:"",variant:l.value?"tonal":"flat",onClick:r[0]||(r[0]=L=>l.value=!l.value)}),{default:n(()=>[a(Ve,null,{default:n(()=>r[2]||(r[2]=[w("mdi-sort-calendar-ascending")])),_:1})]),_:2},1040,["variant"])]),_:1})]),default:n(()=>[a(M,{class:"mt-4"},{default:n(()=>[t.value?(f(),_(B,{key:0,type:"table"})):(f(),b("div",je,[a(y),o.value.length?T("",!0):(f(),b("div",Ke," Aucun participant n'est encore inscrit sur ce séjour. ")),(f(!0),b(C,null,X(o.value,(P,L)=>(f(),_(I,{participant:P,index:L},{actions:n(()=>[a(ye,{density:"comfortable"},{default:n(()=>[a($,{title:"Modifier","prepend-icon":"mdi-pencil",onClick:at=>v.value=P},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["participant","index"]))),256))]))]),_:1}),v.value!=null?(f(),_(ge,{key:0,"model-value":v.value!=null,"onUpdate:modelValue":r[1]||(r[1]=P=>v.value=null),"max-width":"800px"},{default:n(()=>[a(U,{participant:v.value.Participant,personne:v.value.Personne,"hide-personne-dossier":"",onSave:u},null,8,["participant","personne"])]),_:1},8,["model-value"])):T("",!0)]),_:1})):(f(),_(B,{key:1,type:"card"}))}}}),Xe=x({__name:"inscriptions",setup(p){const e=Y(),t=E(()=>Oe(e.currentRoute.value.query)),s=E(()=>t.value.tab||"insc"),i=be("participants");function l(o){var g;const c=e.currentRoute.value;e.push({path:c.path,query:{tab:o}}),o=="participants"&&((g=i.value)==null||g.loadParticipants())}return(o,c)=>{var g;return f(),b(C,null,[a(J,{title:`${(g=k(m).camp)==null?void 0:g.Label} - Suivi des inscriptions`},{default:n(()=>[a(qe,{"model-value":s.value,"onUpdate:modelValue":c[0]||(c[0]=v=>l(v))},{default:n(()=>[a(j,{value:"insc"},{default:n(()=>c[2]||(c[2]=[w("Nouvelles inscriptions")])),_:1}),a(j,{value:"participants"},{default:n(()=>c[3]||(c[3]=[w("Liste des participants")])),_:1})]),_:1},8,["model-value"])]),_:1},8,["title"]),a(Be,{"model-value":s.value},{default:n(()=>[a(K,{value:"insc"},{default:n(()=>[a(We,{onGoTo:c[1]||(c[1]=()=>l("participants"))})]),_:1}),a(K,{value:"participants"},{default:n(()=>[a(Qe,{ref_key:"participants",ref:i},null,512)]),_:1})]),_:1},8,["model-value"])],64)}}}),Ye=[{path:"/",component:Ne},{path:"/inscriptions",component:Xe}],Je="/directeurs",A=De({history:He(Je),routes:Ye});A.onError((p,e)=>{var t,s;(s=(t=p==null?void 0:p.message)==null?void 0:t.includes)!=null&&s.call(t,"Failed to fetch dynamically imported module")?localStorage.getItem("vuetify:dynamic-reload")?console.error("Dynamic import error, reloading page did not fix it",p):(console.log("Reloading page to fix dynamic import error"),localStorage.setItem("vuetify:dynamic-reload","true"),location.assign(e.fullPath)):console.error(p)});A.isReady().then(()=>{localStorage.removeItem("vuetify:dynamic-reload")});function Oe(p){return{tab:p.tab}}function Ze(p){p.use(Ae).use(A)}const et=["innerHTML"],tt=x({__name:"App",setup(p){const e=we({text:"",color:"secondary",action:void 0,timeout:4e3}),t=h(""),s=h("");return m.onError=(i,l)=>{t.value=i,s.value=l},m.showMessage=(i,l,o)=>{e.text=i,e.color=l||"success",e.action=o,e.timeout=1e4,e.timeout=4e3},(i,l)=>{const o=Ie("router-view");return f(),_(xe,null,{default:n(()=>[a(ke,null,{default:n(()=>[a(o),a(W,{style:{"z-index":"10000"},app:"","model-value":e.text!="","onUpdate:modelValue":l[1]||(l[1]=c=>e.text=""),timeout:e.timeout,color:e.color,location:"bottom left","close-on-content-click":""},{default:n(()=>[w(S(e.text)+" ",1),e.action?(f(),_(R,{key:0,onClick:l[0]||(l[0]=c=>e.action.action()),class:"ml-2"},{default:n(()=>[w(S(e.action.title),1)]),_:1})):T("",!0)]),_:1},8,["model-value","timeout","color"]),a(W,{app:"","model-value":t.value!="","onUpdate:modelValue":l[2]||(l[2]=c=>t.value=""),timeout:4e3,color:"red"},{default:n(()=>[q("b",null,S(t.value),1),q("div",{innerHTML:s.value},null,8,et)]),_:1},8,["model-value"])]),_:1})]),_:1})}}}),O=Pe(tt);Ze(O);O.mount("#app");
